<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="my soul my beats" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="学习总结 思考感悟 知识管理">
<meta property="og:type" content="website">
<meta property="og:title" content="my soul my beats">
<meta property="og:url" content="http://mzeht.com/index.html">
<meta property="og:site_name" content="my soul my beats">
<meta property="og:description" content="学习总结 思考感悟 知识管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="my soul my beats">
<meta name="twitter:description" content="学习总结 思考感悟 知识管理">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> my soul my beats </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">my soul my beats</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/13/企业征信客户端竞争品分析/" itemprop="url">
                  企业征信移动客户端竞品分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-13T17:12:31+08:00" content="Apr 13 2016">
              Apr 13 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/文档/" itemprop="url" rel="index">
                    <span itemprop="name">文档</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/13/企业征信客户端竞争品分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/13/企业征信客户端竞争品分析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="企加">企加</h1><h2 id="图例">图例</h2><p><img src="http://7xsxyu.com2.z0.glb.clouddn.com/gif/jiaohuqjiahome.gif" alt=""></p>
<h2 id="布局">布局</h2><p>1.首页是传统的tab 和view的切换模式，中间的按钮“企业查询”重点突出<br>2，进入app第一个模块是企业头条，分为推荐和我的关注，推荐是所有企业的新闻，我的关注是关注的企业相关头条。</p>
<h2 id="颜色">颜色</h2><p>以蓝白黑灰为主，白色背景，蓝色主题</p>
<h2 id="交互细节">交互细节</h2><p>下拉刷新自定义的”企“字设计的较好，周围边框有loadding效果，输出处理结果会以动态添加试图的形式通知客户，点击进入webview在工具栏的下方有progressbar指示进度。</p>
<h2 id="小结">小结</h2><p>刷新的交互和中间按钮的强调设计</p>
<h1 id="企查查">企查查</h1><h2 id="图例-1">图例</h2><p><img src="http://7xsxyu.com2.z0.glb.clouddn.com/gif/jiaohuqcchome.gif" alt=""></p>
<h2 id="布局-1">布局</h2><p>1.侧滑式首页设计，没有下侧的切换按钮<br>2，系统栏颜色配合工具栏<br>2，从上往下依次是搜索区域，功能引导区域，热搜区域，关注区域，新闻区域</p>
<h2 id="颜色-1">颜色</h2><p>以红色为主题，白色背景，图标颜色很多</p>
<h2 id="交互细节-1">交互细节</h2><p>搜索区域下整体滑动，保持搜索区域始终可见，新闻区域不触发下拉刷新，点击刷新的方式</p>
<h2 id="小结-1">小结</h2><p>系统状态栏的设置整体感较强</p>
<p><a href="https://www.jianguoyun.com/p/DftAlPkQpN36BRjD1BQ" target="_blank" rel="external">Excel分析文档下载</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/22/MongoDB/" itemprop="url">
                  MongoDB
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-22T20:55:47+08:00" content="Mar 22 2016">
              Mar 22 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/文档/" itemprop="url" rel="index">
                    <span itemprop="name">文档</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/22/MongoDB/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/22/MongoDB/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简单介绍">简单介绍</h1><h2 id="简介">简介</h2><p>MongoDB是一个基于分布式文件存储的数据库，由C++语言编写，旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB是一个高性能，开源，无模式的文档型数据库，官方给自己的定义是Key-value存储(高性能和高扩展)和传统RDBMS(丰富的查询和功能)之间的一座桥梁</p>
<h2 id="Document和BSON">Document和BSON</h2><p>MongoDB中保存的数据格式为BSON，如：。<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/bson.jpg" alt=""></p>
<p>MongoDB中数据的基本单元称为文档(Document)，它是MongoDB的核心概念，由多个键极其关联的值有序的放置在一起组成，数据库中它对应于关系型数据库的行。</p>
<p>数据在MongoDB中以BSON（Binary-JSON）文档的格式存储在磁盘上。</p>
<p>BSON（Binary Serialized Document Format）是一种类json的一种二进制形式的存储格式，简称Binary JSON，BSON和JSON一样，支持内嵌的文档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Date和BinData类型。</p>
<p>BSON的优点是灵活性高，但它的缺点是空间利用率不是很理想，BSON有三个特点：轻量性、可遍历性、高效性。</p>
<h1 id="文档的增删查改">文档的增删查改</h1><h2 id="简单插入文档">简单插入文档</h2><p>在数据库中，数据插入是最基本的操作，在MongoDB使用db.collection.insert(document)语句来插入文档，如下图：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/insert1.png" alt=""></p>
<p>document是文档数据，collection是存放文档数据的集合。</p>
<p>例如：所有用户的信息存放在users集合中，每个用户的信息为一个user文档，插入数据:</p>
<p>db.users.insert(user);<br>如果collection存在，document会添加到collection目录下， 如果collection不存在，数据库会先创建collection，然后再保存document。</p>
<p>练习一下：把自己的姓名(name)和年龄(age)保存到person集合中！<br>如果想要查看已插入的person文档，可以使用：db.person.find()查看当前库中person集合里的数据。</p>
<p>如果想要查看当前数据库中的集合列表，可以使用：show collections。</p>
<p>db.person.insert({name:’阿牛’, age:28});</p>
<h2 id="批量插入文档">批量插入文档</h2><p>insert语句不但可以插入单个文档，还可以一次性插入多个文档。</p>
<p>插入多个文档时，insert命令的参数为一个数组，数组元素为BSON格式的文档。</p>
<p>多个文档可以放在一个数组内，一次插入多条数据，例如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.insert([&#123;<span class="property">name</span>:<span class="string">"tommy"</span>&#125;,&#123;<span class="property">name</span>:<span class="string">"xiaoming"</span>&#125;])</span><br></pre></td></tr></table></figure>
<p>文档批量插入非常方便，但是使用批量插入时也有一些问题需要注意，因为BSON格式的限制，一次插入的数据量不能超过16M，在一个insert命令中插入多条数据时，MongoDB不保证完全成功或完全失败。</p>
<p>使用insert命令将以下数据一次性插入person集合中。</p>
<p>文／Te_Lee（简书作者）<br>原文链接：<a href="http://www.jianshu.com/p/1e402922ee32/" target="_blank" rel="external">http://www.jianshu.com/p/1e402922ee32/</a><br>著作权归作者所有，转载请联系作者获得授权，并标注“简书作者”。</p>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">age</th>
<th style="text-align:center">status</th>
</tr>
</thead>
<tbody>
<tr>
<td>mary</td>
<td style="text-align:center">21</td>
<td style="text-align:center">A</td>
</tr>
<tr>
<td>Lucy</td>
<td style="text-align:center">89</td>
<td style="text-align:center">A</td>
</tr>
<tr>
<td>Jacky</td>
<td style="text-align:center">30</td>
<td style="text-align:center">A</td>
</tr>
</tbody>
</table>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.person.insert([</span><br><span class="line"> &#123;<span class="string">name:</span><span class="string">"Mary"</span>,  <span class="string">age:</span><span class="number">21</span>, <span class="string">status:</span><span class="string">"A"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">name:</span><span class="string">"Lucy"</span>,  <span class="string">age:</span><span class="number">89</span>, <span class="string">status:</span><span class="string">"A"</span>&#125;,</span><br><span class="line"> &#123;<span class="string">name:</span><span class="string">"Jacky"</span>, <span class="string">age:</span><span class="number">30</span>, <span class="string">status:</span><span class="string">"A"</span>&#125; </span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h2 id="查询文档">查询文档</h2><p>在MongoDB中，查询指向特定的文档集合，查询设定条件，指明MongoDB需要返回的文档；查询也可以包含一个投影，指定返回的字段。</p>
<p>如下图，在查询过程指定了一个查询条件和一个排序修饰。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/21/nodejs-mongodb实现简单购物网站/" itemprop="url">
                  nodejs + mongodb实现简单购物网站
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-21T22:53:59+08:00" content="Mar 21 2016">
              Mar 21 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/项目/" itemprop="url" rel="index">
                    <span itemprop="name">项目</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/21/nodejs-mongodb实现简单购物网站/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/21/nodejs-mongodb实现简单购物网站/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求与设计">需求与设计</h1><h2 id="功能介绍">功能介绍</h2><ol>
<li><p>用户可以完成注册、登录然后登录后对商品的浏览。</p>
</li>
<li><p>登录之后，用户可以对相关商品进行选购并添加到购物车。</p>
</li>
<li><p>用户可以对购物车里面的商品进行增加、减少、删除操作。</p>
</li>
<li><p>用户可对购物车商品进行结算操作。</p>
</li>
</ol>
<h2 id="技术选型">技术选型</h2><p>本项目涉及使用到NodeJS、Express框架、MongoDB数据库、Mongoose对象模型库，详细介绍如下：</p>
<p>NodeJS：Node.js采用Google Chrome浏览器的V8引擎，一个后端的Javascript运行环境，提供很多系统级的API，如文件操作、网络编程等。</p>
<p>MongoDB：MongoDB是一个基于分布式文件存储的一个高性能，开源，无模式的文档型数据库，数据以BSON文档的格式存储在磁盘上。</p>
<p>Express：一个简洁、灵活的基于Node.js的Web应用开发框架, 支持Ejs、jade等多种模板，并且提供一系列强大的功能，比如：模板解析、静态文件服务、中间件、路由控制等等。</p>
<p>Mongoose：一个针对MongoDB操作的对象模型库，封装了MongoDB对文档的的一些增删改查等常用方法。</p>
<h2 id="结构划分">结构划分</h2><p>项目主要分为以下几大模块：注册模块，登录模块，商品模块、购物车模块、结算模块。</p>
<ol>
<li><p>用户注册模块：填写用户名、密码、确认密码后，实现成功注册，然后进行登录。</p>
</li>
<li><p>用户登录模块：填写已注册的用户名称，填写正确的密码，进入商品展示页面。</p>
</li>
<li><p>商品模块：用户选择相关产品加入购物车。</p>
</li>
<li><p>购物车模块：对相关商品进行增加、减少、删除操作。</p>
</li>
<li><p>结算模块：对购物车内已选择商品进行结算。</p>
</li>
</ol>
<p>模块结构如下图所示：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/module.jpg" alt="image"></p>
<h2 id="流程设计">流程设计</h2><p>此流程图显示用户可以进行登录和注册操作，如果用户已经注册，则可以直接登录，若未注册则必须先注册成功后才能进行登录，登录成功后可以进入商品页浏览商品，也可以选择相关商品并可加入购物车，在购物车页面内可以对购物车商品进行相关操作，最后结选择相关商品进行结算。</p>
<p>其流程如下图所示：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/process.jpg" alt=""></p>
<h1 id="数据库设计">数据库设计</h1><h2 id="数据库介绍">数据库介绍</h2><p>数据库的使用呢，我们这里选择了MongoDB。</p>
<p>MongoDB的简单介绍如下：</p>
<p>MongoDB是一个开源的NoSQL数据库，相比MySQL那样的关系型数据库，它更显得轻巧、灵活， 非常适合在数据规模很大、事务性不强的场合下使用。同时它也是一个对象数据库，没有表、行等概念，也没有固定的模式和结构，所有的数据以文档的形式存储，数据格式就是JSON。</p>
<p>MongoDB —— 是一个对象数据库，没有表、行等概念，也没有固定的模式和结构，所有的数据以Document(以下简称文档)的形式存储(Document，就是一个关联数组式的对象，它的内部由属性组成，一个属性对应的值可能是一个数、字符串、日期、数组，甚至是一个嵌套的文档。)</p>
<p>我们一共要创建三个集合，分别是user(用户)集合、commodity(商品)集合、cart(购物车)集合，后面我们会一一介绍。</p>
<h2 id="user集合属性值展示">user集合属性值展示</h2><p>关于user集合，我们设计的属性有name(用户名)、password(密码)， 如下所示：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/c_user.jpg" alt=""></p>
<h2 id="commodity集合属性值展示">commodity集合属性值展示</h2><p>关于commodity集合，我们设计的属性有name(商品名称)、price(商品价格)、imgSrc(商品展示图片路径)， 如下所示：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/c_commodity.jpg" alt=""></p>
<h2 id="carts集合属性值展示">carts集合属性值展示</h2><p>关于cart集合，我们设计的属性有uId(用户ID)、cId(商品ID)、cName(商品名称)、cPrice(商品价格)、cImgSrc(商品展示图片路径)、cQuantity(商品数量)、cStatus(商品结算状态，未结算为false,已结算为true)， 如下所示：<br>![](<a href="http://7xqtsx.com1.z0.glb.clouddn.com/c_cart.jpg" target="_blank" rel="external">http://7xqtsx.com1.z0.glb.clouddn.com/c_cart.jpg</a></p>
<h1 id="详细设计">详细设计</h1><h2 id="注册模块功能设计介绍">注册模块功能设计介绍</h2><p>功能：本模块主要用于新用户注册，用户通过表单提供用户名和密码信息，系统根据用户提供的注册信息对用户进行具体操作。</p>
<p>输入操作：用户名、密码、确认密码。</p>
<p>对应处理：</p>
<ol>
<li>输入注册信息：在页面提供的表单处输入用户的用户名和密码信息，点击“注册”按钮提交表单数据信息。已注册用户，可点击“登录”按钮，进入登录页面。</li>
</ol>
<p>(2) 用户注册身份验证：连接数据库，以输入的“用户名”数据为查询条件来查看输入用户名是否已存在，如果用户名未注册，则提示注册成功并转到登录页进行登录，如果用户已注册，则给出用户已存在提示并重新注册。</p>
<h2 id="注册界面">注册界面</h2><p>用户注册界面草图如下：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Register.jpg" alt=""></p>
<h2 id="登录模块设计与实现">登录模块设计与实现</h2><p>功能：本模块主要用于对用户身份进行鉴别。用户通过表单提供用户名和密码信息，系统根据用户提供的登录信息对用户进行查询鉴别。 如果身份合法，则用户可进入商品页面。</p>
<p>输入操作：用户名、密码。</p>
<p>对应处理：</p>
<ol>
<li><p>输入用户的登录信息：在页面提供的表单处输入用户的用户名和密码信息，点击“登录”按钮提交表单数据信息。 也可点击“注册”按钮，注册新用户。</p>
</li>
<li><p>用户身份进行验证：连接数据库，打开user集合，检验用户登录信息。以输入的“用户名”数据为查询条件来查看用户是否存在，如果存在，继续检验其输入密码是否正确，密码和用户名都正确，则进入商品展示页面；如果用户名不存在或密码不正确，则给出相应的提示。</p>
</li>
</ol>
<h2 id="登录界面草图">登录界面草图</h2><p>用户登录界面草图如下：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Login.jpg" alt=""></p>
<h2 id="商品页面介绍">商品页面介绍</h2><p>商品页呢，我们主要要来展示商品，用户登录成功之后将会跳入商品页，可对所有商品进行查看， 每个商品信息的内容包括：商品名称、商品图片、商品价格，用户可浏览也可将其加入购物车。</p>
<p>页面草图如下所示：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Commodity.jpg" alt=""></p>
<h2 id="商品页面介绍-1">商品页面介绍</h2><p>关于购物车页面，主要展示用户已购买的商品，包括商品的信息、价格、数量，当然用户可以对其中商品进行增加、减少、删除操作，最后，用户可选择对其中商品进行结算，选择结算后，会提示相应的付款金额。</p>
<p>页面草图如下所示：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Cart.jpg" alt=""></p>
<h1 id="实现注册">实现注册</h1><h2 id="简单启动">简单启动</h2><p>首先呢，我们先新建一个项目工程目录，然后在目录下创建启动文件app.js，开始我们的第一步。</p>
<p>这里我们会用到Express框架来实现相关功能，所以，需要先安装它，具体安装方法这里就不在做介绍了。</p>
<p>在启动文件添加如下内容，来测试Express框架是否引用成功。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = require(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>&#123;  </span><br><span class="line">   res.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>浏览器查看结果，如收到响应信息则表明我们项目的第一步已经成功搞定。</p>
<h2 id="创建目录">创建目录</h2><p>项目已经启动成功，下面我们开始创建相关目录，用于存储不同的文件。</p>
<p>说明：右侧栏”文件管理”中可添加相应目录和文件。</p>
<ol>
<li><p>public目录：存放静态文件。</p>
</li>
<li><p>routes目录：存放路由文件。</p>
</li>
<li><p>views目录： 存放页面文件。</p>
</li>
<li><p>common目录：存放公共文件。</p>
</li>
<li><p>public目录(可不选)，新建javascripts、stylesheets、images三个目录用以存储js、css、img相关文件。</p>
</li>
</ol>
<p>这里我们内置了一些js、css文件来实现简单页面样式和操作，在页面视图中直接使用即可，引用方法如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"example/css/bootstrap.min.css"</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> &gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"example/js/jquery.min.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"example/js/bootstrap.min.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="添加文件">添加文件</h2><p>有了目录，我们开始添加文件，先来添加一个登录页面register.html，便于管理和开发我们统一把视图页面放到views目录下。</p>
<p>views目录，添加register.html注册视图页，如下简单效果图：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Register.jpg" alt=""></p>
<p>有了视图页面，我们就可以访问它了，那要如何访问呢，这里就要使用到ejs模板了，安装方法不在阐述，直接如下引用：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app<span class="built_in">.</span><span class="built_in">set</span>( <span class="string">'view engine'</span>, <span class="string">'html'</span> );</span><br><span class="line">app<span class="built_in">.</span>engine( <span class="string">'.html'</span>, <span class="keyword">require</span>( <span class="string">'ejs'</span> )<span class="built_in">.</span>__express );</span><br></pre></td></tr></table></figure>
<p>使用engine函数注册模板引擎并指定处理后缀名为html的文件。</p>
<p>设定视图存放的目录</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app<span class="built_in">.</span><span class="built_in">set</span>(<span class="string">'views'</span>, <span class="keyword">require</span>(<span class="string">'path'</span>)<span class="built_in">.</span><span class="keyword">join</span>(__dirname, <span class="string">'views'</span>));</span><br></pre></td></tr></table></figure>
<p>如果是在本地项目中，我们还要指定本地静态资源访问的路径,如下设置：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.<span class="keyword">static</span>(<span class="keyword">require</span>(<span class="string">'path'</span>).<span class="keyword">join</span>(__dirname, <span class="string">'public'</span>)));</span><br></pre></td></tr></table></figure>
<h2 id="访问注册页">访问注册页</h2><p>有了视图页面，下面我们就开始访问它，app.js文件部分内容，引入相关模块资源，然后简单访问如下：</p>
<p>app.get(‘/‘, function (req, res) {<br>    res.render(‘register’);<br>});<br>app.listen(80);<br>本节启动访问80端口，如成功看到注册页面则表示项目已经运行成功，如未看到，查看相关错误信息，是否缺少相关模块，安装和引用即可。</p>
<h2 id="定义Schema">定义Schema</h2><p>首先在common目录内添加models.js文件用来保存各个集合的Schema文件(集合属性)，也便于我们查看和访问，具体内容如下所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">    user: &#123;</span><br><span class="line">        name: &#123; <span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span> &#125;,</span><br><span class="line">        password: &#123; <span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span> &#125;,</span><br><span class="line">        gender: &#123; <span class="keyword">type</span>: <span class="built_in">Boolean</span>, <span class="keyword">default</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>有了集合的Schema文件，如何访问呢，接着我们会介绍如何使用Model模型操作这些属性。</p>
<h2 id="创建公共方法">创建公共方法</h2><p>还是common目录，我们在新建一个公共方法 —— dbHelper.js文件，来操作这些Schema，因为后面还会涉及此问题，所以我们写成一个公共的方法，dbHelper文件内容如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>),</span><br><span class="line">    Schema = mongoose.Schema,</span><br><span class="line">    models = <span class="built_in">require</span>(<span class="string">'./models'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> m <span class="keyword">in</span> models) &#123;</span><br><span class="line">    mongoose.model(m, <span class="keyword">new</span> Schema(models[m]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">    getModel: <span class="function"><span class="keyword">function</span> <span class="params">(type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _getModel(<span class="keyword">type</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> _getModel = <span class="function"><span class="keyword">function</span> <span class="params">(type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mongoose.model(<span class="keyword">type</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如上所示我们通过getModel可获取集合的Model模型就可以对数据库有实质性的操作了</p>
<p>关于Model，简单介绍：由Schema构造生成的模型，具有数据库操作的行为。</p>
<h2 id="添加函数">添加函数</h2><p>关于dbHelper.js文件里方法的访问很简单，如下所示：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">global</span>.dbHelper = <span class="built_in">require</span>( <span class="string">'./common/dbHelper'</span> );</span><br></pre></td></tr></table></figure>
<p>这里我们使用globa来定义全局变量dbHelper，那么dbHelper就可以在任何模块内调用了。</p>
<p>然后我们就开始修改register视图页面，添加单击事件，例如：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="variable">type=</span><span class="string">"button"</span>  <span class="variable">onclick=</span><span class="string">"register()"</span> <span class="variable">value=</span><span class="string">"注 册"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>对应register()函数，大致如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="comment">//通过serialize()方法进行序列化表单值，创建文本字符串。</span></span><br><span class="line">   <span class="keyword">var</span> data = $(<span class="string">"form"</span>).serialize();</span><br><span class="line">   <span class="comment">//例如："username=张三&amp;password=12345"</span></span><br><span class="line">   $.ajax(&#123;</span><br><span class="line">       url:<span class="string">'/register'</span>,</span><br><span class="line">       type:<span class="string">'POST'</span>,</span><br><span class="line">       data:data,</span><br><span class="line">       success:<span class="function"><span class="keyword">function</span><span class="params">(data,status)</span></span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(status == <span class="string">'success'</span>)&#123;</span><br><span class="line">               location.href=<span class="string">'register'</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       error:<span class="function"><span class="keyword">function</span><span class="params">(res,err)</span></span>&#123;</span><br><span class="line">           location.href=<span class="string">'register'</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加路由">添加路由</h2><p>这里我们需要新建一个文件register.js，专门用来处理来之register页面的post请求， 在后面的学习中还会有多个不同处理文件，万所以我们统一管理在routes目录下，在实际开发中我们可能需要针对不同文件请求给出相应文件的处理，所以我们就做分开处理。</p>
<p>这里贴出register.js文件处理get和post请求的相关代码以供参考，如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// app：express对象</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span></span> &#123;</span><br><span class="line">  app.get(<span class="string">'/register'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span> &#123;</span><br><span class="line">      res.render(<span class="string">'register'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  app.post(<span class="string">'/register'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span></span> &#123;</span><br><span class="line">     var User = global.dbHelper.getModel(<span class="string">'user'</span>),</span><br><span class="line">     uname = req.body.uname;</span><br><span class="line">     User.findOne(&#123;name: uname&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, doc)</span></span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (doc) &#123;</span><br><span class="line">            req.session.<span class="built_in">error</span> = <span class="string">'用户名已存在！'</span>;</span><br><span class="line">            res.send(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            User.create(&#123;</span><br><span class="line">                name: uname,</span><br><span class="line">                password: req.body.upwd</span><br><span class="line">            &#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, doc)</span></span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">error</span>) &#123;</span><br><span class="line">                    res.send(<span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    req.session.<span class="built_in">error</span> = <span class="string">'用户名创建成功！'</span>;</span><br><span class="line">                    res.send(<span class="number">200</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模块的加载和引用">模块的加载和引用</h2><p>register的post请求处理中，我们使用了session(express-session模块)还有处理post请求数据的body属性(body-parser和multer模块)，需先安装他们，然后引用即可，如下参考：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="comment">//引用模块</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="keyword">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> multer = <span class="keyword">require</span>(<span class="string">'multer'</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="keyword">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">//调用中间件使用</span></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.json());</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123; extended: <span class="keyword">true</span> &#125;));</span><br><span class="line">app.<span class="keyword">use</span>(multer());</span><br></pre></td></tr></table></figure>
<p>后面我们还会再次添加多个路由记录，所以便于管理和访问，我们可以把他们统一放到一起，比如routes目录下新建index.js文件专门用来存放添加的文件，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./register'</span>)(app);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>那么我们在app.js文件中直接引用index.js文件就可以访问这些文件了，如下所示：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>(<span class="string">'./routes'</span>)(app); <span class="regexp">//app</span><span class="symbol">:express</span>对象。;</span><br></pre></td></tr></table></figure>
<h2 id="中间件传递信息">中间件传递信息</h2><p>这里我们就一步到位，在register的post请求处理中我们使用了express-session模块来保存相关信息，这里我们就使用中间件来传递这些提示信息，中间件内容如下所示：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(function(req, res, next)&#123;</span><br><span class="line">    res.locals.user = req.session.user; <span class="comment">//保存用户信息</span></span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">err</span> = req.session.<span class="keyword">error</span>;  <span class="comment">//保存结果响应信息</span></span><br><span class="line">    res.locals.message = '';  <span class="comment">// 保存html标签</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">err</span>) res.locals.message = '&lt;div <span class="keyword">class</span>=<span class="string">"alert alert-danger"</span> style=<span class="string">"margin-bottom: 20px;color:red;"</span>&gt;' + <span class="keyword">err</span> + '&lt;/div&gt;';</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里注意中间件的安放位置，还有我们设置了变量message并为其简单添加了样式，这里我们在register视图里就用它来作为操作结果的信息提示，直接添加&lt;%- message %&gt;到视图第一个div内即可。</p>
<p>关于注册我们基本已经准备就绪，开始打开连接数据库并设置用户过期时间(注意执行顺序，应放置在首个中间件位置)，app.js条件内容如下：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mongoose.<span class="keyword">connect</span>(<span class="string">"mongodb://127.0.0.1:27017/test"</span>);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">use</span>(session(&#123;</span><br><span class="line">    secret:<span class="string">'secret'</span>,</span><br><span class="line">    cookie:&#123;</span><br><span class="line">        maxAge:<span class="number">1000</span>*<span class="number">60</span>*<span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>到这里，注册功能已经完毕，在用户注册的信息录入中，我们没有进行相关的为空、两次密码的不匹配等等验证等等(可自行添加)，赶紧注册试试吧，本地的话可以通过MongoVUE(可视化客户端)来查看数据是否成功写入数据库。</p>
<h1 id="登陆和浏览">登陆和浏览</h1><h2 id="添加视图">添加视图</h2><p>前面我们已经实现了注册功能，用户可以成功注册，接着我们就开始让用户登录了，此节我们就实现用户的登录功能，并且登录成功后跳转商品页面查看商品。</p>
<p>首先，我们还是在views目录下添加登录视图页面 —— login.html，效果图如下：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Login.jpg" alt=""></p>
<h2 id="访问视图">访问视图</h2><p>有了登录页面，那么注册页面(register)的登录按钮添加指向登陆页面的链接，相应的登陆页的注册按钮也是如此。</p>
<p>这里我们还是添加一个相对应的文件用来处理login页面的请求，routes目录下新建名为login.js的文件，先来增加一个处理get请求的方法，代码参考如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span> </span>&#123;</span><br><span class="line">    app.<span class="keyword">get</span>(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">        res.render(<span class="string">'login'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和register文件一样添加到index.js中，如下：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require<span class="list">('./login')</span><span class="list">(<span class="keyword">app</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>register视图页的register()函数的回调中，当注册成功时我们就可以跳转到登陆页面了，如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=<span class="string">'login'</span>;</span><br></pre></td></tr></table></figure>
<p>好，赶紧试试登陆、注册按钮能否成功跳转吧！</p>
<h2 id="实现登陆">实现登陆</h2><p>我们为登陆按钮增加单击事件和对应函数login()，参考如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//通过serialize()方法获取form表单内输入框用户名、密码的值</span></span><br><span class="line">  <span class="comment">//如："username=张三&amp;password=12345"</span></span><br><span class="line">  <span class="keyword">var</span> data = $(<span class="string">"form"</span>).serialize();</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">      url:<span class="string">'/login'</span>,</span><br><span class="line">      type:<span class="string">'POST'</span>,</span><br><span class="line">      data:data,</span><br><span class="line">      success:<span class="function"><span class="keyword">function</span><span class="params">(data,status)</span></span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(status == <span class="string">'success'</span>)&#123;</span><br><span class="line">              location.href=<span class="string">'home'</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      error:<span class="function"><span class="keyword">function</span><span class="params">(data,status)</span></span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(status == <span class="string">"error"</span>)&#123;</span><br><span class="line">              location.href=<span class="string">'login'</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在相应的login.js文件中，我们还得添加相对应的post请求处理方法，接着我们会讲述。</p>
<h2 id="登陆处理">登陆处理</h2><p>关于login视图页的post请求处理，我们需要判断用户所输入用户名是否存在，密码是否正确，并使用变量保存相应提示信息，当用户名和密码全部正确时，则返回成功并保存用户的个人信息，用作来判断用户的登陆状态，具体可参考register视图页的post请求。</p>
<p>login.js文件的post请求处理代码，参考如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> User = <span class="keyword">global</span>.dbHelper.getModel(<span class="string">'user'</span>),uname = req.body.uname;</span><br><span class="line">  User.findOne(&#123;name: uname&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, doc)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (用户不存在) &#123;</span><br><span class="line">                req.session.error = <span class="string">'用户名不存在！'</span>;</span><br><span class="line">                res.send(<span class="number">404</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(用户存在，密码错误) &#123;</span><br><span class="line">                   req.session.error = <span class="string">"密码错误!"</span>;</span><br><span class="line">                   res.send(<span class="number">404</span>);</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123; <span class="comment">//用户名、密码正确</span></span><br><span class="line">                   req.session.user=doc;</span><br><span class="line">                   res.send(<span class="number">200</span>);</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还记得我们登陆的本地变量message嘛，用来保存html标签并包含相应提示信息，这里在登陆页面我们也可以使用，用法：&lt;%- message %&gt;，指定到相应位置即可。</p>
<h2 id="商品页视图">商品页视图</h2><p>用户登录成功之后则跳转至home视图页面(商品主页)，就可以进行对商品的浏览和选择了。</p>
<p>还是views目录，添加home商品视图页，如下简单效果图：</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Commodity.jpg" alt=""></p>
<p>用户成功登录之后跳转至home页，这里我们还是做分开处理，routes目录下新建home.js文件用来处理来之home也的get请求。</p>
<p>这里我们假设如果用户未登录将不能查看商品主页，所以，在请求处理中我们还需要判断用户的登陆状态，这个可以使用我们在登录处理时所保存的用户个人信息。</p>
<p>关于商品页的视图展示我们只需要有其名称、价格、图片，这里使用ejs模板循环展示，可参考如下方式：</p>
<p>注：Commodity：商品集合所有数据，内置图片路径为“/example/img”</p>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/home_refer.jpg" alt=""></p>
<h2 id="请求处理">请求处理</h2><p>在home的get请求处理中，我们需要首先判断用户的登陆状态，只有用户登录了方可跳转到商品页，如果为登陆呢则跳转到登录页，而且在进入商品页的时候并传入Commodity集合的所有数据数据在页面展示。</p>
<p>首先呢，在models.js文件中定义Commodity集合的Schema属性，共包括商品名称、商品价格、商品图片，这里简单定义如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">commodity</span>: &#123;</span><br><span class="line">   <span class="attribute">name</span>: String,</span><br><span class="line">   <span class="attribute">price</span>: Number,</span><br><span class="line">   <span class="attribute">imgSrc</span>: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>routes目录下添加home.js文件(index.js文件中引用)。</p>
<p>具体处理方式可参考如下代码：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span> </span>&#123;</span><br><span class="line">    app.<span class="keyword">get</span>(<span class="string">'/home'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(req.session.user)&#123;</span><br><span class="line">            <span class="keyword">var</span> Commodity = global.dbHelper.getModel(<span class="string">'commodity'</span>);</span><br><span class="line">            Commodity.find(&#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, docs)</span> </span>&#123;</span><br><span class="line">               <span class="comment">//将Commoditys变量传入home模板</span></span><br><span class="line">               res.render(<span class="string">'home'</span>,&#123;Commoditys:docs&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            req.session.error = <span class="string">"请先登录"</span></span><br><span class="line">            res.redirect(<span class="string">'/login'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加商品">添加商品</h2><p>添加商品，views目录下添加addcommodity视图页面用来对商品的添加，这里简单样式参考如下：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Addcommodity.jpg" alt=""></p>
<p>相对应的addcommodity函数参考代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//imgSrc表示图片路径)，这里内置了5张图片，格式为：xmsz-X.jpg(X为1-5数字)。</span></span><br><span class="line"><span class="keyword">var</span> data = $(<span class="string">"form"</span>).serialize()+<span class="string">"&amp;imgSrc="</span> + <span class="string">"xmsz-"</span>+<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">5</span>+<span class="number">1</span>)+<span class="string">".jpg"</span>;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">     url:<span class="string">'/addcommodity'</span>,</span><br><span class="line">     type:<span class="string">'POST'</span>,</span><br><span class="line">     data:data,</span><br><span class="line">     success:<span class="function"><span class="keyword">function</span><span class="params">(data,status)</span></span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(status == <span class="string">'success'</span>)&#123;</span><br><span class="line">            alert(<span class="string">'添加成功！'</span>)</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     error:<span class="function"><span class="keyword">function</span><span class="params">(data,err)</span></span>&#123;</span><br><span class="line">         alert(<span class="string">'添加失败！'</span>)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="商品添加处理">商品添加处理</h2><p>这里我们就直接在home.js文件中添加保存商品的处理方法，如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="string">'/addcommodity'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    res.render(<span class="string">'addcommodity'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">'/addcommodity'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Commodity = global.dbHelper.getModel(<span class="string">'commodity'</span>);</span><br><span class="line">    Commodity.create(&#123;</span><br><span class="line">        name: req.body.name,</span><br><span class="line">        price: req.body.price,</span><br><span class="line">        imgSrc: req.body.imgSrc</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, doc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (doc) &#123;</span><br><span class="line">            res.send(<span class="number">200</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.send(<span class="number">404</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>到这里关于商品页的展示和添加就完成了</p>
<h1 id="购物车结算">购物车结算</h1><h2 id="添加商品链接">添加商品链接</h2><p>上节课程里我们已经实现了商品的添加和展示，接下来我们开始进行对商品的操作——加入购物车。</p>
<p>首先，商品页的加入购物车按钮、购物车查看按钮添加链接，如下所示：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/addToCart/</span></span></span>&lt;%=<span class="ruby"><span class="constant">Commoditys</span>[i]._id</span>%&gt;<span class="xml"><span class="tag"><span class="value">"</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>我们先定义购物车(cart)集合的Schema属性，包含：uId(用户ID)、cId(商品ID)、cName(商品名称)、cPrice(商品价格)、cImgSrc(商品展示图片路径)、cQuantity(商品数量)、cStatus(商品结算状态，默认为false)，参考如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cart:&#123;</span><br><span class="line">       uId: &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">String</span> &#125;,</span><br><span class="line">       cId: &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">String</span> &#125;,</span><br><span class="line">       cName: &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">String</span> &#125;,</span><br><span class="line">       cPrice: &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">String</span> &#125;,</span><br><span class="line">       cImgSrc: &#123; <span class="class"><span class="keyword">type</span>:</span><span class="type">String</span> &#125; ,</span><br><span class="line">       cQuantity: &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">Number</span> &#125;,</span><br><span class="line">       cStatus : &#123; <span class="class"><span class="keyword">type</span>:</span> <span class="type">Boolean</span>, <span class="keyword">default</span>: <span class="literal">false</span>  &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>以上属性定义我们还是统一放到models.js文件中以方便管理和操作。<br>接着views目录下添加购物车(cart.html)视图页面，参考如下：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/Cart.jpg" alt=""></p>
<p>购物车页面的展示实现可参考如下贴图：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/cart_refer.jpg" alt=""></p>
<h2 id="访问视图-1">访问视图</h2><p>接着在routes目录添加cart.js文件(index.js文件中引用)，来定义路由处理规则。</p>
<ol>
<li>比如cart路径的处理，如下：</li>
</ol>
<p>1.1 检测登陆用户是否过期，已过期则跳转login页同时给出提示信息。<br>1.2 通过global.dbHelper.getModel方法获取cart模型。<br>1.3 通过find查询用户所有商品并传入模板，条件：用户ID，结算状态。<br>1.4 贴出部分代码：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="string">'/cart'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">     ......</span><br><span class="line">   Cart.find(&#123;<span class="string">"uId"</span>:用户ID,<span class="string">"cStatus"</span>:<span class="literal">false</span>&#125;,<span class="function"><span class="keyword">function</span> <span class="params">(error, docs)</span> </span>&#123;</span><br><span class="line">       res.render(<span class="string">'cart'</span>,&#123;carts:docs&#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol>
<li>加入购物车按钮链接所对应路径的处理，如：/addToCart/:商品id</li>
</ol>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"/addToCart/:id"</span>, function(req, res) <span class="decorator">&#123;...&#125;</span>);</span><br></pre></td></tr></table></figure>
<p>2.1 通过req.params.id获取商品ID号并检测登陆用户状态。<br>2.2 通过global.dbHelper.getModel方法获取购物车(cart)、商品(commodity)模型。<br>2.3 商品已存在则进行更新操作，贴出部分参考代码：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cart.update(&#123;<span class="string">"uId"</span>:用户ID,<span class="string">"cId"</span>:商品ID&#125;,&#123;<span class="string">$set:</span>&#123;<span class="string">cQuantity:</span>已有数量+<span class="number">1</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.4商品未存在则进行添加操作，贴出部分代码：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Commodity.findOne(&#123;<span class="string">"_id"</span>: 商品ID&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error, doc)</span> </span>&#123;</span><br><span class="line">        Cart.create(&#123;</span><br><span class="line">            uId: 用户ID,</span><br><span class="line">            cId: 商品ID,</span><br><span class="line">            cName: doc.name,</span><br><span class="line">            cPrice: doc.price,</span><br><span class="line">            cImgSrc: doc.imgSrc,</span><br><span class="line">            cQuantity : <span class="number">1</span></span><br><span class="line">        &#125;,<span class="function"><span class="keyword">function</span><span class="params">(error,doc)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(doc)&#123;</span><br><span class="line">                res.redirect(<span class="string">'/home'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="商品的单选和全选">商品的单选和全选</h2><p>在购物车页面展示还是使用ejs模板(具体实现可参考贴图)来实现用户购物车商品的展示，现期间我们用到了checkbox，这里我们就来简单的实现商品的全选和单选。</p>
<p>首先，简单介绍实现步骤：</p>
<ol>
<li>用户选中全选按钮时，列表内选框全部变为勾选状态。</li>
<li>用户取消全选按钮选中状态时，列表内选框全部取消勾选状态。</li>
<li>列表内选框为全部勾选状态时，全选按钮为选中状态，反之不勾选。</li>
<li>全选按钮未选中情况下，当列表内按钮全部选中则全选按钮也要被选中。<br>对于checkbox按钮如下图所示：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/checkbox.jpg" alt=""></li>
</ol>
<p>注：data-index属性存储索引值用来获取商品数量，data=id存储商品ID，data-price存储商品价格。</p>
<p>实现全选：为全选框(如id为CheckAll)添加单击事件，这里我们使用prop方法设置checkbox状态、is方法判断checkbox状态，如下参考示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#CheckAll'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">var</span> self = $(<span class="keyword">this</span>);</span><br><span class="line">      $(<span class="string">'input[name="chkItem"]'</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">         $(<span class="keyword">this</span>).prop(<span class="string">"checked"</span>,self.is(<span class="string">':checked'</span>));</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>实现单选：单选框(如name为chkItem)添加单击事件，这里我们使用prop方法设置checkbox状态、not方法判断checkbox状态，如下参考示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'input[name="chkItem"]:checkbox'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> isCheck = $(<span class="string">'input[name="chkItem"]:not(:checked)'</span>).length?<span class="literal">false</span>:<span class="literal">true</span>;</span><br><span class="line">   $(<span class="string">'#CheckAll'</span>).prop(<span class="string">"checked"</span>,isCheck);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>到这里我们就简单实现了按钮的全选和单选，以上方法可供参考也可以自行思路去实现。</p>
<h2 id="商品的增加和减少">商品的增加和减少</h2><p>前面我们实现了对于商品的单选和全选功能，下面我们就开始实现商品数量的加减。</p>
<p>对于+、-按钮如下图所示：<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/add-subtr.jpg" alt=""></p>
<p>简单实现步骤如下：</p>
<ol>
<li>定义data-type属性用于区分+、-按钮。</li>
<li>a标签添加单击事件。并同时改变显示框的值。</li>
<li>使用siblings()方法改变同级标签的数量值。<br>具体实现可参考如下方法：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.li-quantity a'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = $(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">type</span> = self.attr(<span class="string">'data-type'</span>),</span><br><span class="line">        num = <span class="built_in">parseFloat</span>(self.siblings(<span class="string">'input'</span>).val());</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">type</span> == <span class="string">'add'</span>)&#123;</span><br><span class="line">          num += <span class="number">1</span>;</span><br><span class="line">     &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">type</span> == <span class="string">'subtr'</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(num &gt; <span class="number">1</span>)&#123;</span><br><span class="line">             num -= <span class="number">1</span>;</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    self.siblings(<span class="string">'input'</span>).val(num);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>到这里对于商品数量的加、减也实现了，接着我们开始实现用户选中商品的总价格计算功能。</p>
<h2 id="计算总金额">计算总金额</h2><p>商品的状态选择和数量的加减功能我们已经实现了，选择我们就开始实现当用户选择相关商品时总金额的计算功能。</p>
<p>实现步骤如下：</p>
<ol>
<li>定义公共方法，用于用户不同加、减、全选等操作时皆可调用。</li>
<li>循环列表内所有被选中的checkbox(假设name为chkItem)。</li>
<li>使用checkbox的相应属性值，来获取价格和数量。</li>
<li>定义全局变量(假设为sum)存储总金额并赋值显示。<br>具体方法实现可参考如下内容：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sum = <span class="number">0</span>;</span><br><span class="line">$(<span class="string">'input[name="chkItem"]:checked'</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = $(<span class="keyword">this</span>),</span><br><span class="line">     price = self.attr(<span class="string">'data-price'</span>),</span><br><span class="line">     index = self.attr(<span class="string">'data-index'</span>);</span><br><span class="line">     <span class="keyword">var</span> quantity = $(<span class="string">'#Q'</span>+index).val();</span><br><span class="line">     sum +=(<span class="built_in">parseFloat</span>(price)*<span class="built_in">parseFloat</span>(quantity));</span><br><span class="line"> &#125;);</span><br><span class="line"> $(<span class="string">"金额标签"</span>).html(<span class="string">'￥'</span>+ sum +<span class="string">'.00'</span>);</span><br></pre></td></tr></table></figure>
<p>到这里，选中商品的价格总计功能也就简单实现了。</p>
<h2 id="商品结算">商品结算</h2><p>关于结算功能，这里就做简单介绍，当用户点击结算按钮时，计算出被选商品的总金额，给予alert出总金额，数据库则更新相应商品的结算状态和数量，当然你也可以在购物车集合中添加一个用户消费金额的属性来保存所消费的金额总数更好，这里就简单处理了。</p>
<p>具体功能实现这里简单介绍如下：</p>
<ol>
<li>定义公共方法，用于用户不同加、减、全选等操作时皆可调用。</li>
<li>循环列表内所有被选中的checkbox(假设name为chkItem)。</li>
<li>使用checkbox的相应属性值，来获取价格和数量。</li>
<li>定义全局变量(假设为sum)存储总金额并赋值显示。<br>这里贴出部分实现代码，如下：</li>
</ol>
<p>//结算方法内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'input[name="chkItem"]:checked'</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">var</span> self = $(<span class="keyword">this</span>),</span><br><span class="line">         <span class="comment">//通过data-index属性，获取索引值</span></span><br><span class="line">         index = self.attr(<span class="string">'data-index'</span>),</span><br><span class="line">        <span class="comment">//通过data-id属性，获取对应ID</span></span><br><span class="line">         ID= self.attr(<span class="string">'data-id'</span>);</span><br><span class="line">     <span class="keyword">var</span> 数量= $(<span class="string">'#Q'</span>+index).val();</span><br><span class="line">     <span class="keyword">var</span> data = &#123; <span class="string">"cid"</span>: ID, <span class="string">"cnum"</span>:数量&#125;;</span><br><span class="line">     <span class="comment">//发送数据请求</span></span><br><span class="line">     ...   </span><br><span class="line">&#125;);</span><br><span class="line">alert(<span class="string">'所付金额为：￥'</span>+sum);</span><br><span class="line">location.href = <span class="string">"cart"</span>;</span><br></pre></td></tr></table></figure>
<p>cart.js文件添加对应路由处理如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">"路径"</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> Cart = <span class="keyword">global</span>.dbHelper.getModel(<span class="string">'cart'</span>);</span><br><span class="line">   Cart.update(&#123;<span class="string">"_id"</span>:req.body.ID&#125;,&#123;<span class="variable">$set</span> : &#123; cQuantity : req.body.数量,cStatus:<span class="keyword">true</span> &#125;&#125;,<span class="function"><span class="keyword">function</span><span class="params">(error,doc)</span></span>&#123; </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="商品删除">商品删除</h2><p>关于商品的删除功能就简单多了，我们只需获取其ID即可实现对于购物车内商品的删除操作</p>
<p>在购物车商品的展示功能实现时，我们就可以获取其ID，如下参考：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">"/delFromCart/&lt;%=carts[i]._id%&gt;"</span> &gt;删除&lt;/a&gt;</span><br><span class="line">cart.js文件，添加对应路径处理方法，这里简单实现参考如下：</span><br><span class="line"></span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">"/delFromCart/:id"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">   <span class="comment">//req.params.id 获取ID号</span></span><br><span class="line">   <span class="keyword">var</span> Cart = global.dbHelper.getModel(<span class="string">'cart'</span>);</span><br><span class="line">   Cart.remove(&#123;<span class="string">"_id"</span>:req.params.id&#125;,<span class="function"><span class="keyword">function</span><span class="params">(error,doc)</span></span>&#123;</span><br><span class="line">       <span class="comment">//成功返回1  失败返回0</span></span><br><span class="line">       <span class="keyword">if</span>(doc &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           res.redirect(<span class="string">'/cart'</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>好，到这里所有功能都已经实现了，赶快好好回味回味所学所悟吧！</p>
<p>附：项目源码下载地址：<a href="https://github.com/hubwiz/example-node" target="_blank" rel="external">https://github.com/hubwiz/example-node</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/18/ConnectManager网络请求的三层封装（模块－转换－底层）/" itemprop="url">
                  ConnectManager网络请求的三层封装（模块－转换－底层）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-18T14:01:47+08:00" content="Mar 18 2016">
              Mar 18 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码/" itemprop="url" rel="index">
                    <span itemprop="name">代码</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/18/ConnectManager网络请求的三层封装（模块－转换－底层）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/18/ConnectManager网络请求的三层封装（模块－转换－底层）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>调用层－数据解析层－底层</p>
<h2 id="调用层">调用层</h2><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">getSystemToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GetSystemTokenParam param = <span class="keyword">new</span> GetSystemTokenParam();</span><br><span class="line">        param.loginId=Constants.LOGINID;</span><br><span class="line">        String password=mPasswordView.getText().toString();</span><br><span class="line">        String encpwd=PasswordUtil.getEncPwd(Constants.LOGINID, password);</span><br><span class="line">        param.password= encpwd;</span><br><span class="line"><span class="comment">//        param.password= password;</span></span><br><span class="line">        L.i(<span class="string">"systemID"</span>,mUsernameView.getText().toString());</span><br><span class="line">        L.i(<span class="string">"明文密码"</span>,mPasswordView.getText().toString());</span><br><span class="line">        L.i(<span class="string">"loginID"</span>,Constants.LOGINID);</span><br><span class="line">        L.i(<span class="string">"password 加密结果为"</span>,encpwd);</span><br><span class="line">        L.i(<span class="string">"password 解密结果为"</span>,PasswordUtil.getDecPwd(Constants.LOGINID,encpwd));</span><br><span class="line">        ConnectManager.getInstance().getSystemToken(param,Tokencallback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AbstractRequestListener&lt;GetSystemTokenBean&gt; Tokencallback = <span class="keyword">new</span> AbstractRequestListener&lt;GetSystemTokenBean&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(GetSystemTokenBean bean)</span> </span>&#123;</span><br><span class="line">            tokenBean = bean;</span><br><span class="line">            tHandler.sendEmptyMessage(ActivityForResultUtil.REQUEST_DATA_SUCCESS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(CustomError customError)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            Message msg = tHandler.obtainMessage();</span><br><span class="line">            msg.obj = customError;</span><br><span class="line">            msg.what = ActivityForResultUtil.REQUEST_DATA_ERROR;</span><br><span class="line">            tHandler.sendMessage(msg);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onFault</span><span class="params">(CustomError fault)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            Message msg = tHandler.obtainMessage();</span><br><span class="line">            msg.obj = fault;</span><br><span class="line">            msg.what = ActivityForResultUtil.REQUEST_DATA_FAULT;</span><br><span class="line">            tHandler.sendMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<h2 id="数据转化层">数据转化层</h2><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="javadoc">/**</span><br><span class="line">    * 请求systemToken</span><br><span class="line">    *</span><br><span class="line">    *<span class="javadoctag"> @param</span> params</span><br><span class="line">    *<span class="javadoctag"> @param</span> callback</span><br><span class="line">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">getSystemToken</span><span class="params">(<span class="keyword">final</span> GetSystemTokenParam params,</span><br><span class="line">                            <span class="keyword">final</span> AbstractRequestListener&lt;GetSystemTokenBean&gt; callback)</span> </span>&#123;</span><br><span class="line">       exector.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">           <span class="annotation">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   String method = params.getParam().getString(<span class="string">"method"</span>);</span><br><span class="line">                   String response = HttpConnectionUtil.openUrl(</span><br><span class="line">                           Constants.SERVER_URL + method, <span class="string">"GET"</span>,</span><br><span class="line">                           params.getParam(),<span class="keyword">false</span>);</span><br><span class="line">                   GetSystemTokenBean bean = GetSystemTokenBean.getSystemTokenBean(response);</span><br><span class="line">                   <span class="keyword">if</span> (callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       callback.onComplete(bean);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                   <span class="keyword">if</span> (callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       callback.onFault(<span class="keyword">new</span> CustomError(network_error));</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                   <span class="keyword">if</span> (callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       callback.onError(<span class="keyword">new</span> CustomError(json_error));</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="网络底层">网络底层</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 发送http请求</span><br><span class="line">    *</span><br><span class="line">    * @param url</span><br><span class="line">    * @param <span class="keyword">method</span></span><br><span class="line">    *            <span class="type">GET</span> 或 <span class="type">POST</span></span><br><span class="line">    * @param params</span><br><span class="line">    * @<span class="keyword">return</span></span><br><span class="line">    */</span><br><span class="line">   public <span class="keyword">static</span> <span class="type">String</span> openUrl(<span class="type">String</span> url, <span class="type">String</span> <span class="keyword">method</span>, <span class="type">Bundle</span> params,boolean <span class="type">Token</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">method</span>.equals(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">           <span class="keyword">if</span> (params != null) &#123;</span><br><span class="line">               url = url + <span class="string">"?"</span> + encodeUrl(params);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">String</span> response = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           L.i(<span class="keyword">method</span> + <span class="string">" URL: "</span> + url);</span><br><span class="line">           <span class="type">HttpClient</span> httpClient = <span class="type">HttpConnectionUtil</span>.getNewHttpClient();</span><br><span class="line">           <span class="type">HttpGet</span> httpGet = new <span class="type">HttpGet</span>(url);</span><br><span class="line">           <span class="keyword">if</span>(<span class="type">Token</span>==<span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">               httpGet.setHeader(<span class="string">"systemToken"</span>, <span class="type">Constants</span>.<span class="type">SYSTEMTOKEN</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           //连接超时</span><br><span class="line">           httpClient.getParams().setParameter(<span class="type">CoreConnectionPNames</span>.<span class="type">CONNECTION_TIMEOUT</span>, <span class="number">20000</span>);</span><br><span class="line">           // 读取超时</span><br><span class="line">           httpClient.getParams().setParameter(<span class="type">CoreConnectionPNames</span>.<span class="type">SO_TIMEOUT</span>, <span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">           <span class="type">HttpResponse</span> resp = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (resp.getStatusLine().getStatusCode() != <span class="type">HttpStatus</span>.<span class="type">SC_OK</span>) &#123;</span><br><span class="line">               L.i(<span class="type">LOG_TAG</span>, <span class="string">"httpGet fail, status code = "</span> + resp.getStatusLine().getStatusCode());</span><br><span class="line"></span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               response = <span class="type">EntityUtils</span>.toString(resp.getEntity());</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">           throw new <span class="type">RuntimeException</span>(e.getMessage(), e);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       L.i(<span class="string">"LOG_TAG"</span>+response);</span><br><span class="line">       <span class="keyword">return</span> response;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="具体封装">具体封装</h1><h2 id="AbstractRequestListener">AbstractRequestListener</h2><p>public abstract class AbstractRequestListener<t extends="" object="">{</t></p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 将response请求解析为针对具体请求的bean
 <span class="keyword">*</span> 
 <span class="keyword">*</span> <span class="comment">@param response </span>
 <span class="keyword">*</span>             请求完成后的响应字符串
 <span class="keyword">*</span> <span class="comment">@return </span>
 <span class="keyword">*</span>             若解析成功，返回解析后的对象，否则返回null
 <span class="keyword">*</span>/
<span class="comment">@SuppressWarnings("unchecked")</span>
public T parse(String response) {
    Class<span class="variable">&lt;?&gt;</span> c = this.getGenericType();
    try {
        Constructor<span class="variable">&lt;T&gt;</span> constructor = (Constructor<span class="variable">&lt;T&gt;</span>) c.getDeclaredConstructor(String.class);
        T result = constructor.newInstance(response);
        return result;
    } catch (Exception e) {
        e.printStackTrace();
    }
    return null;
}

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 获取T的类型
 <span class="keyword">*</span> <span class="comment">@param</span>
 <span class="keyword">*</span> <span class="comment">@return</span>
 <span class="keyword">*</span>/
private Class<span class="variable">&lt;?&gt;</span> getGenericType() {
    Type genType = getClass().getGenericSuperclass();
    if (!(genType instanceof ParameterizedType)) {
        return Object.class;
    }
    Type[] params = ((ParameterizedType) genType).getActualTypeArguments();
    if (params.length <span class="variable">&lt; 1) {
        throw new RuntimeException("Index outof bounds");
    }
    if (!(params[0] instanceof Class)) {
        return Object.class;
    }
    return (Class&lt;?&gt;</span>) params[0];
}

 /<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 请求完成后以对象形式返回服务器的响应的结果
 <span class="keyword">*</span> 
 <span class="keyword">*</span> <span class="comment">@param bean </span>
 <span class="keyword">*</span>             服务器返回的响应字符串解析后得到的对象
 <span class="keyword">*</span>        
 <span class="keyword">*</span>/
public abstract void onComplete(T bean);

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 服务器返回了错误结果，已经正确的链接上了服务器但有错误如：缺少参数.等
 <span class="keyword">*</span> 
 <span class="keyword">*</span> <span class="comment">@param customError</span>
 <span class="keyword">*</span>/
public abstract void onError(CustomError customError);

/<span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> 在请求期间发生了严重问题（如：网络故障、访问的地址不存在等）
 <span class="keyword">*</span> 
 <span class="keyword">*</span> <span class="comment">@param fault</span>
 <span class="keyword">*</span>/
public abstract void onFault(CustomError fault);
</code></pre><p>}</p>
<h2 id="CustomError">CustomError</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomError</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="javadoc">/**</span><br><span class="line">     * 错误码</span><br><span class="line">     */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mErrorCode;</span><br><span class="line"></span><br><span class="line">	<span class="javadoc">/** 原始响应URL */</span></span><br><span class="line">	<span class="keyword">private</span> String mResponse;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomError</span><span class="params">(String errorMessage)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(errorMessage);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomError</span><span class="params">(<span class="keyword">int</span> errorCode, String errorMessage, String orgResponse)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(errorMessage);</span><br><span class="line">		<span class="keyword">this</span>.mErrorCode = errorCode;</span><br><span class="line">		<span class="keyword">this</span>.mResponse = orgResponse;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrgResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mResponse;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span>  <span class="title">getErrorCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mErrorCode;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"errorCode:"</span> + <span class="keyword">this</span>.mErrorCode + <span class="string">"\nerrorMessage:"</span></span><br><span class="line">				+ <span class="keyword">this</span>.getMessage() + <span class="string">"\norgResponse:"</span> + <span class="keyword">this</span>.mResponse;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="javadoc">/**</span><br><span class="line">	 * 将服务器返回的errorMessage转换成定义的易于理解的字符串</span><br><span class="line">	 * </span><br><span class="line">	 *<span class="javadoctag"> @param</span> errorCode</span><br><span class="line">	 * 			服务器返回的错误代码</span><br><span class="line">	 *<span class="javadoctag"> @param</span> errorMessage</span><br><span class="line">	 * 			服务器返回的错误字符串，和错误代码一一对应</span><br><span class="line">	 *<span class="javadoctag"> @return</span></span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">interpretErrorMessage</span><span class="params">(<span class="keyword">int</span> errorCode, String errorMessage)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (errorCode) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="javadoc">/**</span><br><span class="line">			 * 错误处理</span><br><span class="line">			 */</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> errorMessage;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RequestParam">RequestParam</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> */</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">RequestParam</span> &#123;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 设置请求参数</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Bundle <span class="title">getParam</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ResponseBean">ResponseBean</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ResponseBean</span> <span class="title">implements</span> <span class="title">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> String response;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ResponseBean</span><span class="params">()</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ResponseBean</span><span class="params">(String response)</span> throws JSONException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(response == <span class="keyword">null</span> || response.equals(<span class="string">""</span>) ||response.equals(<span class="string">"null"</span>))</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> JSONException(<span class="string">"数据解析异常"</span>);</span><br><span class="line">		 </span><br><span class="line">		<span class="keyword">this</span>.response = response;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResponse</span><span class="params">(String response)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.response = response;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> response;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 保存</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title">saveModel</span><span class="params">()</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		   L.i(<span class="string">"save_model"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 更新</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title">updateModel</span><span class="params">()</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		 L.i(<span class="string">"update_model"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 删除</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span>   <span class="keyword">void</span> <span class="title">deleteModel</span><span class="params">()</span></span><br><span class="line">	</span>&#123;</span><br><span class="line">		 L.i(<span class="string">"delete_model"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="用法">用法</h1><p>参见Demo，给别人做的毕业设计。</p>
<p>Demo地址<a href="https://github.com/mzeht/ZhiHuiYun" target="_blank" rel="external">https://github.com/mzeht/ZhiHuiYun</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/17/express框架/" itemprop="url">
                  express框架
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-17T12:08:02+08:00" content="Mar 17 2016">
              Mar 17 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/文档/" itemprop="url" rel="index">
                    <span itemprop="name">文档</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/17/express框架/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/17/express框架/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基础知识">基础知识</h1><h2 id="Express介绍">Express介绍</h2><p>　　npm提供了大量的第三方模块，其中不乏许多Web框架，比如我们本章节要讲述的一个轻量级的Web框架 ——— Express。</p>
<p>　　Express是一个简洁、灵活的node.js Web应用开发框架, 它提供一系列强大的功能，比如：模板解析、静态文件服务、中间件、路由控制等等,并且还可以使用插件或整合其他模块来帮助你创建各种 Web和移动设备应用,是目前最流行的基于Node.js的Web开发框架，并且支持Ejs、jade等多种模板，可以快速地搭建一个具有完整功能的网站。</p>
<p>　　好，下面我们就开始吧！</p>
<p>NPM安装</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> express</span><br></pre></td></tr></table></figure>
<p>获取、引用</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="reserved">var</span> app = express();</span><br></pre></td></tr></table></figure>
<p>通过变量“app”我们就可以调用express的各种方法了，好戏刚刚开始，继续加油吧！</p>
<h2 id="创建应用">创建应用</h2><p>　　认识了Express框架，我们开始创建我们的第一个express应用。</p>
<p>　　在我们的默认项目主文件app.js添加如下内容：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = require(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(request, response)</span> </span>&#123;  </span><br><span class="line">   response.send(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>　　说明：在后面课程学习中，我们会统一使用80端口用于监听请求。</p>
<p>　　添加完毕之后，通过右侧栏的“测试地址”来查看浏览器内容，当看到“Hello World!”内容就表明一个简单的express应用已经创建成功了。
　　</p>
<h2 id="get请求">get请求</h2><p>　前面我们实现了一个简单的express应用，下面我们就开始具体讲述它的具体实现，首先我们先来学习Express的常用方法。</p>
<p>　　get方法 —— 根据请求路径来处理客户端发出的GET请求。</p>
<p>　　格式：app.get(path,function(request, response));</p>
<p>　　path为请求的路径，第二个参数为处理请求的回调函数，有两个参数分别是request和response，代表请求信息和响应信息。</p>
<p>如下示例：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = require(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">   response.send(<span class="string">'Welcome to the homepage!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">   response.send(<span class="string">'Welcome to the about page!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">    response.send(<span class="string">"404 error!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>　　上面示例中，指定了about页面路径、根路径和所有路径的处理方法。并且在回调函数内部，使用HTTP回应的send方法，表示向浏览器发送一个字符串。</p>
<p>　　参照以上代码，试试自己设定一个get请求路径，然后浏览器访问该地址是否可以请求成功。
　　</p>
<h2 id="all函数的基本用法">all函数的基本用法</h2><p>　　和get函数不同app.all()函数可以匹配所有的HTTP动词，也就是说它可以过滤所有路径的请求，如果使用all函数定义中间件，那么就相当于所有请求都必须先通过此该中间件。</p>
<p>格式：app.all(path,function(request, response));</p>
<p>如下所示，我们使用all函数在请求之前设置响应头属性。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = require(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.all(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response, next)</span> </span>&#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html;charset=utf-8"</span> &#125;);      <span class="comment">//设置响应头属性值</span></span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">    response.end(<span class="string">"欢迎来到首页!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">"/about"</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">    response.end(<span class="string">"欢迎来到about页面!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>&#123;</span><br><span class="line">    response.end(<span class="string">"404 - 未找到!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>　　上面代码参数中的“*”表示对所有路径有效，这个方法在给特定前缀路径或者任意路径上处理时会特别有用，不管我们请求任何路径都会事先经过all函数。
　　</p>
<h2 id="use基本用法1">use基本用法1</h2><p>use是express调用中间件的方法，它返回一个函数。</p>
<p>格式：app.use([path], function(request, response, next){});</p>
<p>可选参数path默认为”/“。</p>
<p>1.使用中间件</p>
<p>app.use(express.static(path.join(__dirname, ‘/‘)));<br>如上呢，我们就使用use函数调用express中间件设定了静态文件目录的访问路径(这里假设为根路径)。</p>
<p>2.如何连续调用两个中间件呢，如下示例：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var express = require(<span class="comment">'express');</span></span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>, <span class="keyword">next</span>)&#123;</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">"method："</span>+<span class="built_in">request</span>.method+<span class="string">" ==== "</span>+<span class="string">"url："</span>+<span class="built_in">request</span>.url);</span><br><span class="line">    <span class="keyword">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>)&#123;</span><br><span class="line">    <span class="built_in">response</span>.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/html;charset=utf-8"</span> &#125;);</span><br><span class="line">    <span class="built_in">response</span>.<span class="keyword">end</span>(<span class="comment">'示例：连续调用两个中间件');</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>回调函数的next参数，表示接受其他中间件的调用，函数体中的next()，表示将请求数据传递给下一个中间件。</p>
<p>上面代码先调用第一个中间件，在控制台输出一行信息，然后通过next()，调用第二个中间件，输出HTTP回应。由于第二个中间件没有调用next方法，所以req对象就不再向后传递了。</p>
<h2 id="use基本用法2">use基本用法2</h2><p>use方法不仅可以调用中间件，还可以根据请求的网址，返回不同的网页内容，如下示例：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var express = require(<span class="string">"express"</span>);</span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>, <span class="keyword">next</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">request</span>.url == <span class="string">"/"</span>) &#123;</span><br><span class="line">      <span class="built_in">response</span>.send(<span class="string">"Welcome to the homepage!"</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">next</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>, <span class="keyword">next</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">request</span>.url == <span class="string">"/about"</span>) &#123;</span><br><span class="line">     <span class="built_in">response</span>.send(<span class="string">"Welcome to the about page!"</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">next</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>) &#123;</span><br><span class="line">  <span class="built_in">response</span>.send(<span class="string">"404 error!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>上面代码通过request.url属性，判断请求的网址，从而返回不同的内容。</p>
<h2 id="回调函数">回调函数</h2><p>　　Express回调函数有两个参数，分别是request(简称req)和response(简称res)，request代表客户端发来的HTTP请求，response代表发向客户端的HTTP回应，这两个参数都是对象。示例如下:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="获取主机名、路径名">获取主机名、路径名</h2><p>　　今天我们就先来学习如何使用req对象来处理客户端发来的HTTP请求。</p>
<p>1.req.host返回请求头里取的主机名(不包含端口号)。</p>
<p>2.req.path返回请求的URL的路径名。</p>
<p>如下示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.path);</span><br><span class="line">    <span class="comment">//console.log(req.host);</span></span><br><span class="line">    res.send(<span class="string">"req.host获取主机名，req.path获取请求路径名!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>试一试在浏览器中输入任意一个请求路径，通过req查看主机名或请求路径。</p>
<p><a href="http://localhost:8000/about" target="_blank" rel="external">http://localhost:8000/about</a></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">about</span></span><br><span class="line">/favicon.ico</span><br></pre></td></tr></table></figure>
<h2 id="query基本用法">query基本用法</h2><p>　　query是一个可获取客户端get请求路径参数的对象属性，包含着被解析过的请求参数对象，默认为{}。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.query.参数名);</span><br><span class="line">    res.send(<span class="string">"测试query属性!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>通过req.query获取get请求路径的对象参数值。</p>
<p>格式：req.query.参数名；请求路径如下示例：</p>
<blockquote>
<p>例1： /search?n=Lenka</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req<span class="class">.query</span><span class="class">.n</span>  <span class="comment">// "Lenka"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>例2： /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">req<span class="class">.query</span><span class="class">.order</span>  <span class="comment">// "desc"</span></span><br><span class="line"> </span><br><span class="line">req<span class="class">.query</span><span class="class">.shoe</span><span class="class">.color</span>  <span class="comment">// "blue"</span></span><br><span class="line"> </span><br><span class="line">req<span class="class">.query</span><span class="class">.shoe</span><span class="class">.type</span>  <span class="comment">// "converse"</span></span><br></pre></td></tr></table></figure>
<p>试一试get请求一个带参数路径，使用“req.query.参数名”方法获取请求参数值。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>('/<span class="keyword">about</span>',function(req,res)&#123;</span><br><span class="line">    console.<span class="literal">log</span>(req.<span class="keyword">query</span>.name);</span><br><span class="line">    res.send(<span class="string">"name="</span>+req.<span class="keyword">query</span>.name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="http://localhost:8000/about?name=mzeht&amp;name=jj" target="_blank" rel="external">http://localhost:8000/about?name=mzeht&amp;name=jj</a></p>
<p>name=mzeht,jj</p>
<h2 id="param基本用法">param基本用法</h2><p>和属性query一样，通过req.param我们也可以获取被解析过的请求参数对象的值。</p>
<p>格式：req.param(“参数名”)；请求路径如下示例：</p>
<p>例1： 获取请求根路径的参数值，如/?n=Lenka，方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.param(<span class="string">"n"</span>)); <span class="comment">//Lenka</span></span><br><span class="line">    res.send(<span class="string">"使用req.param属性获取请求根路径的参数对象值!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>例2：我们也可以获取具有相应路由规则的请求对象，假设路由规则为 /user/:name/，请求路径/user/mike,如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="string">"/user/:name/"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    console.log(req.param(<span class="string">"name"</span>)); <span class="comment">//mike</span></span><br><span class="line">    res.send(<span class="string">"使用req.param属性获取具有路由规则的参数对象值!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>PS：所谓“路由”，就是指为不同的访问路径，指定不同的处理方法。<br>如果没有相应参数的数据 req.param 返回值为undefined;</p>
<p>看了上面的示例，试一试使用req.param属性解析一个请求路径对象，并获取请求参数值。</p>
<h2 id="params基本用法">params基本用法</h2><p>和param相似，但params是一个可以解析包含着有复杂命名路由规则的请求对象的属性。</p>
<p>格式：req.params.参数名；</p>
<p>例1. 如上课时请求根路径的例子，我们就可以这样获取，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">"/user/:name/"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.params.name); <span class="comment">//mike</span></span><br><span class="line">    res.send(<span class="string">"使用req.params属性获取具有路由规则的参数对象值!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>查看运行结果，和param属性功能是一样的，同样获取name参数值。</p>
<p>例2：当然我们也可以请求复杂的路由规则，如/user/:name/:id，假设请求地址为：/user/mike/123，如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="built_in">get</span>(<span class="string">"/user/:name/:id"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(req.params.id); //<span class="string">"123"</span></span><br><span class="line">    <span class="keyword">res</span>.send(<span class="string">"使用req.params属性复杂路由规则的参数对象值!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>对于请求地址具有路由规则的路径来说，属性params比param属性是不是又强大了那么一点点呢！</p>
<h2 id="send基本用法">send基本用法</h2><p>send()方法向浏览器发送一个响应信息，并可以智能处理不同类型的数据。格式如下：</p>
<p>res.send([body|status], [body]);<br>1.当参数为一个String时，Content-Type默认设置为”text/html”。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="built_in">send</span>(<span class="string">'Hello World'</span>);<span class="comment"> //Hello World</span></span><br></pre></td></tr></table></figure>
<p>2.当参数为Array或Object时，Express会返回一个JSON。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">res</span><span class="class">.send</span>(&#123; <span class="attribute">user</span>: <span class="string">'tobi'</span> &#125;); <span class="comment">//&#123;"user":"tobi"&#125;</span></span><br><span class="line"><span class="tag">res</span><span class="class">.send</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]); <span class="comment">//[1,2,3]</span></span><br></pre></td></tr></table></figure>
<p>3.当参数为一个Number时，并且没有上面提到的任何一条在响应体里，Express会帮你设置一个响应体，比如：200会返回字符”OK”。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="built_in">send</span>(<span class="number">200</span>);<span class="comment"> // OK</span></span><br><span class="line">res.<span class="built_in">send</span>(<span class="number">404</span>);<span class="comment"> // Not Found</span></span><br><span class="line">res.<span class="built_in">send</span>(<span class="number">500</span>);<span class="comment"> // Internal Server Error</span></span><br></pre></td></tr></table></figure>
<p>send方法在输出响应时会自动进行一些设置，比如HEAD信息、HTTP缓存支持等等。</p>
<p>ps:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fri, <span class="number">18</span> Mar <span class="number">2016</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">43</span> GMT express deprecated req.<span class="function"><span class="title">param</span><span class="params">(name)</span></span>: Use req<span class="class">.params</span>, req<span class="class">.body</span>, or req<span class="class">.query</span> instead at app<span class="class">.js</span>:<span class="number">37</span>:<span class="number">21</span></span><br><span class="line">Fri, <span class="number">18</span> Mar <span class="number">2016</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">43</span> GMT express deprecated req.<span class="function"><span class="title">param</span><span class="params">(name)</span></span>: Use req<span class="class">.params</span>, req<span class="class">.body</span>, or req<span class="class">.query</span> instead at app<span class="class">.js</span>:<span class="number">38</span>:<span class="number">21</span></span><br><span class="line">Fri, <span class="number">18</span> Mar <span class="number">2016</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">43</span> GMT express deprecated res.<span class="function"><span class="title">send</span><span class="params">(status)</span></span>: Use res.<span class="function"><span class="title">sendStatus</span><span class="params">(status)</span></span> instead at app<span class="class">.js</span>:<span class="number">42</span>:<span class="number">9</span></span><br></pre></td></tr></table></figure>
<h1 id="准备登陆">准备登陆</h1><h2 id="模板引擎">模板引擎</h2><p>　　从本节课程开始我们要使用express框架实现一个简单的用户登陆功能，让我们先准备一下相关资源。</p>
<p>　　在nodejs中使用express框架，它默认的是ejs和jade渲染模板，今天我们就以ejs模板为例，讲述模板渲染网页模板的基础功能。</p>
<p>1.ejs模板安装方法</p>
<p>npm install ejs<br>2.目录下安装好了之后，如何调用呢，如下所示：</p>
<p>//指定渲染模板文件的后缀名为ejs<br>app.set(‘view engine’, ‘ejs’);<br>默认ejs模板只支持渲染以ejs为扩展名的文件，可能在使用的时候会觉得它的代码书写方式很不爽还是想用html的形式去书写，该怎么办呢，这时就得去修改模板引擎了，也就会用到express的engine函数。</p>
<p>engine注册模板引擎的函数，处理指定的后缀名文件。</p>
<p>// 修改模板文件的后缀名为html<br>app.set( ‘view engine’, ‘html’ );<br>// 运行ejs模块<br>app.engine( ‘.html’, require( ‘ejs’ ).<strong>express );<br>“</strong>express”，ejs模块的一个公共属性，表示要渲染的文件扩展名。</p>
<h2 id="静态资源">静态资源</h2><p>由于环境的限制，这里我们就不使用静态资源了，但是实际开发中我们肯定会用到，具体使用规则已在下面列出，可参考。</p>
<p>如果要在网页中加载静态文件（css、js、img），就需要另外指定一个存放静态文件的目录，当浏览器发出非HTML文件请求时，服务器端就会到这个目录下去寻找相关文件。</p>
<p>1.项目目录下添加一个存放静态文件的目录为public。</p>
<p>2.在public目录下在添加三个存放js、css、img的目录，相应取名为javascripts、stylesheets、images。</p>
<p>3.然后就可以把相关文件放到相应的目录下了。</p>
<p>4.比如，浏览器发出如下的样式表请求：</p>
<p> <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" media="screen"><br>服务器端就到public/stylesheets/目录中寻找bootstrap.min.css文件。</p>
<p>有了静态目录文件，我们还得在启动文件里告诉它这个静态文件路径，需要指定一下，如下所示：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.<span class="keyword">static</span>(<span class="keyword">require</span>(<span class="string">'path'</span>).<span class="keyword">join</span>(__dirname, <span class="string">'public'</span>)));</span><br></pre></td></tr></table></figure>
<p>PS：express.static —— 指定静态文件的查找目录。</p>
<p>使用use函数调用中间件指定express静态访问目录，’public’就是我们我们新建的用来存放静态文件的总目录。</p>
<h2 id="添加视图">添加视图</h2><p>好，下面我们就来添加网页模板了，项目中我们会新建一个目录用来单独存放模板文件，这里我们就统一放到根路径上了。</p>
<p>下面开始新建index.html、login.html、home.html三个页面。</p>
<p>index.html页面参考内容如下：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="variable">style=</span><span class="string">"height:400px;width:550px;margin:50px auto;margin-left:auto;border:solid 1px;background: rgb(246, 246, 253);"</span>&gt;</span><br><span class="line">    &lt;div <span class="variable">style=</span><span class="string">"margin-left: 35px;"</span>&gt;</span><br><span class="line"><span class="comment"># 首页</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;form <span class="variable">action=</span><span class="string">"#"</span>  <span class="variable">role=</span><span class="string">"form"</span> <span class="variable">style=</span><span class="string">"margin-top: 90px;margin-left: 60px;"</span>&gt;</span><br><span class="line"><span class="comment"># 欢迎进入首页！</span></span><br><span class="line">            &lt;div <span class="variable">style=</span><span class="string">"margin-top: 145px;"</span>&gt;</span><br><span class="line">                &lt;input <span class="variable">type=</span><span class="string">"button"</span> <span class="variable">value=</span><span class="string">"登 陆"</span> /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>login.html页面参考内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.jquery.com/jquery-2.1.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"height:300px;width:350px;margin:100px auto;margin-left:auto;border:solid 1px;background: rgb(246, 246, 253);"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"width:200px;margin:auto;margin-top:50px;"</span>&gt;</span></span><br><span class="line"># 用户登录</span><br><span class="line">        <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"#"</span>  <span class="attribute">role</span>=<span class="value">"form"</span> <span class="attribute">method</span>=<span class="value">"post"</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"username"</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"username"</span> <span class="attribute">style</span>=<span class="value">"margin: 20px 0px;"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"password"</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">name</span>=<span class="value">"password"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"margin-top:30px;margin-left:125px;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">value</span>=<span class="value">"登 陆"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>home.html页面参考内容如下：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="variable">style=</span><span class="string">"height:400px;width:550px;margin:50px auto;margin-left:auto;border:solid 1px;background: rgb(246, 246, 253);"</span>&gt;</span><br><span class="line">    &lt;div <span class="variable">style=</span><span class="string">"margin-left: 45px;"</span>&gt;</span><br><span class="line"><span class="comment"># 主页</span></span><br><span class="line">        &lt;form <span class="variable">action=</span><span class="string">"#"</span>  <span class="variable">role=</span><span class="string">"form"</span> <span class="variable">style=</span><span class="string">"margin-top: 90px;"</span>&gt;</span><br><span class="line"><span class="comment"># 登陆成功！</span></span><br><span class="line">            &lt;div <span class="variable">style=</span><span class="string">"margin-top: 145px;"</span>&gt;</span><br><span class="line">                &lt;input  <span class="variable">type=</span><span class="string">"button"</span> <span class="variable">value=</span><span class="string">"退 出"</span> /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>和静态文件一样，我们也要设置views存放的目录，如下：<br>// 设定views变量，意为视图存放的目录</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">set</span>(<span class="string">'views'</span>, __dirname);</span><br></pre></td></tr></table></figure>
<p>有了网页模板和指定目录，下面就可以访问它们了。</p>
<h2 id="访问视图">访问视图</h2><p>我们要如何对网页模板进行访问呢，这就要用到res对象的render函数了。</p>
<p>1.render函数，对网页模板进行渲染。</p>
<p>2.格式：res.render(view, [locals], callback);</p>
<p>3.参数view就是模板的文件名callback用来处理返回的渲染后的字符串，options、callback可省略，在渲染模板时locals可为其模板传入变量值，在模板中就可以调用所传变量了，在后面我们会讲述具体使用方法，也可先自行使用看其效果。</p>
<p>4.比如渲染我们刚刚添加的index.html页面，我们就可以在app.js中写入如下内容：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> path = <span class="keyword">require</span>(<span class="string">'path'</span>);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">set</span>(<span class="string">'views'</span>, __dirname);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">set</span>( <span class="string">'view engine'</span>, <span class="string">'html'</span> );</span><br><span class="line">app.engine( <span class="string">'.html'</span>, <span class="keyword">require</span>( <span class="string">'ejs'</span> ).__express );</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> <span class="comment">&#123;</span><br><span class="line">    res.render('index');</span><br><span class="line">&#125;</span>);</span></span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>运行之后在测试地址我们就可以看到所渲染的index页面了，试一试其他页面是否也可渲染成功？</p>
<h2 id="redirect基本用法">redirect基本用法</h2><p>redirect方法允许网址的重定向，跳转到指定的url并且可以指定status，默认为302方式。</p>
<p>格式：res.redirect([status], url);</p>
<p>例1：使用一个完整的url跳转到一个完全不同的域名。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">res</span>.redirect(<span class="string">"http://www.hubwiz.com"</span>);</span><br></pre></td></tr></table></figure>
<p>例2：跳转指定页面，比如登陆页，如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">res</span>.redirect(<span class="string">"login"</span>);</span><br></pre></td></tr></table></figure>
<p>后面我们开始实现登陆功能，先试一下redirect重定向，跳转到我们网站如何？</p>
<h1 id="实现登陆">实现登陆</h1><h2 id="访问视图-1">访问视图</h2><p>前面我们已经添加了视图模板并学习了访问视图的方法，那我们就先回顾一下。</p>
<p>1.参考以下代码，地址栏访问这几个请求路径查看是否可以成功。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    res.render(<span class="string">'index'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    res.render(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/home'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    res.render(<span class="string">'home'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当浏览器看到了相应的视图页面就说明我们的代码是没有问题的，继续加油吧！</p>
<h2 id="用户登陆">用户登陆</h2><p>前面我们学习了express的get请求方法，今天我们就学习它的post请求方法。</p>
<p>1.post方法 —— 根据请求路径来处理客户端发出的Post请求。</p>
<p>2.格式：app.post(path,function(req, res));</p>
<p>3.和get方法一样，path为请求的路径，第二个参数为处理请求的回调函数，req和res分别代表请求信息和响应信息。</p>
<p>4.例如处理login的post请求，如下示例</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>了解了post方法，下面我们就开始使用post来实现简单的用户登陆功能。</p>
<h2 id="body基本用法">body基本用法</h2><p>实现登陆之前我们先来了解一个属性 —— body。</p>
<p>body属性解析客户端的post请求参数，通过它可获取请求路径的参数值。</p>
<p>格式：req.body.参数名；</p>
<p>下面我们就来测试body属性的功能，做一些准备工作。</p>
<p>修改login.html，为登陆按钮增加登陆事件。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="keyword">type</span>=<span class="string">"button"</span> onclick=<span class="string">"login();"</span> value=<span class="string">"登 陆"</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> username = $(<span class="string">'#username'</span>).val();</span><br><span class="line">   <span class="keyword">var</span> data = &#123; <span class="string">"username"</span>: username &#125;;</span><br><span class="line">   $.ajax(&#123;</span><br><span class="line">           url:<span class="string">'/login'</span>,</span><br><span class="line">           <span class="keyword">type</span>:<span class="string">'POST'</span>,</span><br><span class="line">           data:data</span><br><span class="line">          &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要想使用body属性解析post请求参数值，我们需要先安装和引用express的两个中间件body-parser和multer，具体方法如下：。<br>2.1安装</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> body-parser</span><br><span class="line">npm <span class="keyword">install</span> multer</span><br></pre></td></tr></table></figure>
<p>2.2引用和调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bodyParser = <span class="keyword">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> multer = <span class="keyword">require</span>(<span class="string">'multer'</span>);</span><br><span class="line">   ......</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.json());</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123; extended: <span class="keyword">true</span> &#125;));</span><br><span class="line">app.<span class="keyword">use</span>(multer());</span><br></pre></td></tr></table></figure>
<p>中间件body-parser和multer用于处理和解析post请求的数据。</p>
<h2 id="body基本用法(2)">body基本用法(2)</h2><p>到这里我们就可以测试post请求的body属性的简单用法了。</p>
<p>1.修改好之后的完整的文件app.js如下所示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="keyword">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> multer = <span class="keyword">require</span>(<span class="string">'multer'</span>);</span><br><span class="line">app.set(<span class="string">'views'</span>, __dirname);</span><br><span class="line">app.set( <span class="string">'view engine'</span>, <span class="string">'html'</span> );</span><br><span class="line">app.engine( <span class="string">'.html'</span>, <span class="keyword">require</span>( <span class="string">'ejs'</span> ).__express );</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.json());</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123; extended: <span class="keyword">true</span> &#125;));</span><br><span class="line">app.<span class="keyword">use</span>(multer());</span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    res.render(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">"/login"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"用户名称为："</span> + req.body.username);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>通过测试地址访问浏览器，试试录入任意一个用户名登录，查看通过body属性是否可以成功获取？</p>
<h2 id="准备登陆-1">准备登陆</h2><p>接下来我们就开始实现登陆功能，让我们要先做一些准备工作，为相关按钮添加点击事件、链接。</p>
<p>1.修改index.html，增加登陆链接。<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="link_label">登 录</span>](<span class="link_url">login</span>)</span><br></pre></td></tr></table></figure></p>
<p>2.强化login页面的login方法，实现一个简单的post请求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> username = $(<span class="string">'#username'</span>).val();</span><br><span class="line">   <span class="keyword">var</span> password = $(<span class="string">'#password'</span>).val();</span><br><span class="line">   <span class="keyword">var</span> data = &#123; <span class="string">"username"</span>: username, <span class="string">"password"</span>:password&#125;;</span><br><span class="line">   $.ajax(&#123;</span><br><span class="line">            url:<span class="string">'login'</span>,</span><br><span class="line">            type:<span class="string">'POST'</span>,</span><br><span class="line">            data:data,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span><span class="params">(data,status)</span></span>&#123;</span><br><span class="line">                 <span class="keyword">if</span>(status == <span class="string">'success'</span>)&#123;</span><br><span class="line">                     location.href=<span class="string">'home'</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            error:<span class="function"><span class="keyword">function</span><span class="params">(data,status,e)</span></span>&#123;</span><br><span class="line">                 <span class="keyword">if</span>(status == <span class="string">"error"</span>)&#123;</span><br><span class="line">                      location.href=<span class="string">'login'</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>网页模板准备已经就绪，下面我们开始修改启动文件app.js的内容。</p>
<h2 id="准备登陆-2">准备登陆</h2><p>下面我们就开始修改app启动文件的内容。</p>
<p>1.修改post方法，这里假设数据库中用户名的名字为admin、密码为admin。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user=&#123;</span><br><span class="line">        username:<span class="string">'admin'</span>,</span><br><span class="line">        password:<span class="string">'admin'</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span>(req.body.username==user.username&amp;&amp;req.body.password==user.password)</span><br><span class="line">    &#123; </span><br><span class="line">       res.send(<span class="number">200</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       res.send( <span class="number">404</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="number">2.</span>一个完整的启动文件app.js如下所示：</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = require(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> bodyParser = require(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> multer = require(<span class="string">'multer'</span>);</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">set</span>(<span class="string">'views'</span>, __dirname);</span><br><span class="line">app.<span class="keyword">set</span>( <span class="string">'view engine'</span>, <span class="string">'html'</span> );</span><br><span class="line">app.engine( <span class="string">'.html'</span>, require( <span class="string">'ejs'</span> ).__express );</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.json());</span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123; extended: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="keyword">use</span>(multer());</span><br><span class="line"> </span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    res.render(<span class="string">'index'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/home'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    res.render(<span class="string">'home'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    res.render(<span class="string">'login'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user=&#123;</span><br><span class="line">        username:<span class="string">'admin'</span>,</span><br><span class="line">        password:<span class="string">'admin'</span></span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">if</span>(req.body.username==user.username&amp;&amp;req.body.password==user.password)      &#123;</span><br><span class="line">      res.send(<span class="number">200</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      res.send( <span class="number">404</span> );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>到这里，一个简单的Post登录就完成了，使用浏览器运行本地端口试试效果吧！</p>
<h2 id="访问控制">访问控制</h2><p>简单登陆部分按照我们的求已经完成了，但网站好些并不安全，反复测试我们发现，home.html页面本来是登陆以后才访问的，现在我们不需登陆，直接在浏览器输入也可访问，这样肯定是不能被允许的，那么我们还得再次对登陆功能进行强化。</p>
<p>1.login.html页面增加EJS模板变量&lt;%- message %&gt;保存登陆提示信息。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;<span class="comment">%- message %&gt;</span></span><br><span class="line"># 用户登录</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>2.home.html页面，登陆成功后跳转并传入用户名：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 恭喜_&lt;<span class="variable">%=</span> user.username <span class="variable">%&gt;</span>_，登陆成功！</span><br></pre></td></tr></table></figure>
<p>PS：使用EJS模板变量值使用&lt;%= variable_name %&gt;输出方式，字符串输出时默认经过escape转义编码。 当我们想要输出一些动态生成的HTML标签时可使用&lt;%- variable_nam %&gt;输出方式，这种方式不会被escape转义编码。</p>
<p>3.home.html页面添加退出链接，如下：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="link_label">退 出</span>](<span class="link_url">logout</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="访问控制-1">访问控制</h2><p>修改好了模板页，下面开始修改启动文件app.js的内容。</p>
<p>1.安装模块express-session并引用，安装、引用不在讲述。</p>
<p>2.使用新模块进行访问时间限制，如下：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> session <span class="subst">=</span> <span class="keyword">require</span>(<span class="string">'express-session'</span>);</span><br><span class="line"><span class="attribute">...</span></span><br><span class="line">app<span class="built_in">.</span>use(session(&#123;</span><br><span class="line">    secret:<span class="string">'secret'</span>,</span><br><span class="line">    resave:<span class="literal">true</span>,</span><br><span class="line">    saveUninitialized:<span class="literal">false</span>,</span><br><span class="line">    cookie:&#123;</span><br><span class="line">        maxAge:<span class="number">1000</span><span class="subst">*</span><span class="number">60</span><span class="subst">*</span><span class="number">10</span>  <span class="comment">//过期时间设置(单位毫秒)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>3.app.js文件新增中间件并设置模板变量值，如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span><span class="params">(req, res, next)</span>&#123;</span></span><br><span class="line">    <span class="keyword">res</span>.locals.user = req.session.user;</span><br><span class="line">    var err = req.session.error;</span><br><span class="line">    <span class="keyword">res</span>.locals.message = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">res</span>.locals.message = <span class="string">'&lt;div style="margin-bottom: 20px;color:red;"&gt;'</span> + err + <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">    <span class="keyword">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>res.locals对象保存在一次请求范围内的响应体中的本地变量值。</p>
<p>PS：注意，中间件的放置顺序很重要，等同于执行顺序。而且，中间件必须放在HTTP动词方法之前，否则不会执行。</p>
<p>4.增加logout路径处理(用户登陆退出)和index路径请求处理，如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="string">'/logout'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">    req.session.user = <span class="literal">null</span>;</span><br><span class="line">    req.session.error = <span class="literal">null</span>;</span><br><span class="line">    res.redirect(<span class="string">'index'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="keyword">get</span>(<span class="string">'/index'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">    res.render(<span class="string">'index'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5.修改home路径请求处理，如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="string">'/home'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.session.user)&#123;</span><br><span class="line">        res.render(<span class="string">'home'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        req.session.error = <span class="string">"请先登录"</span></span><br><span class="line">        res.redirect(<span class="string">'login'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5.修改路径为login的Post请求</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/login'</span>,function(req,<span class="keyword">res)&#123;</span></span><br><span class="line">    var <span class="keyword">user</span>=<span class="keyword">&#123;</span></span><br><span class="line">        username:<span class="string">'admin'</span>,</span><br><span class="line">        <span class="literal">password</span>:<span class="string">'admin'</span></span><br><span class="line">    <span class="keyword">&#125;</span></span><br><span class="line"> <span class="keyword">if</span>(req.body.username==<span class="keyword">user</span>.username&amp;&amp;req.body.<span class="literal">password</span>==<span class="keyword">user</span>.<span class="keyword">password)&#123;</span></span><br><span class="line">        req.session.<span class="keyword">user</span> = <span class="keyword">user</span>;</span><br><span class="line">        res.send(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">&#125;</span><span class="keyword">else&#123;</span></span><br><span class="line">        req.session.error = <span class="string">"用户名或密码不正确"</span>;</span><br><span class="line">        res.send( <span class="number">404</span> );</span><br><span class="line">    <span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword">&#125;</span>);</span><br></pre></td></tr></table></figure>
<p>好，全部修改完毕，再次访问测试地址试试效果吧！</p>
<h1 id="路由登陆">路由登陆</h1><h2 id="路由介绍">路由介绍</h2><p>路由 ————为不同的访问路径，指定不同的处理方法。 在app.js中我们指定了app.get、app.post的不同路径的多个路由规则，在实际开发应用中，也会碰到具有多个路由记录的情况，针对这个问题，我们就要对这些路由记录做分开处理，以便于管理。</p>
<p>我们还是在登陆例子的基础上做如下修改。</p>
<p>1.添加三个js文件，名称分别为login、home、logout。</p>
<p>2.login.js文件，添加如下内容：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span> </span>&#123;</span><br><span class="line">    app.<span class="keyword">get</span>(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">        res.render(<span class="string">'login'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    app.post(<span class="string">'/login'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> user=&#123;</span><br><span class="line">            username:<span class="string">'admin'</span>,</span><br><span class="line">            password:<span class="string">'admin'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(req.body.username==user.username&amp;&amp;req.body.password==user.password)&#123;</span><br><span class="line">            req.session.user = user;</span><br><span class="line">            res.send(<span class="number">200</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            req.session.error = <span class="string">"用户名或密码不正确"</span></span><br><span class="line">            res.send( <span class="number">404</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.home.js文件，添加如下内容：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span></span> &#123;</span><br><span class="line">    app.get(<span class="string">'/home'</span>,<span class="function"><span class="keyword">function</span><span class="params">(req,res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(req.session.user)&#123;</span><br><span class="line">            res.render(<span class="string">'home'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            req.session.<span class="built_in">error</span> = <span class="string">"请先登录"</span></span><br><span class="line">            res.redirect(<span class="string">'login'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用路由2">使用路由2</h2><p>4.logout.js文件，添加如下内容：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">( app )</span> </span>&#123;</span><br><span class="line">    app.<span class="keyword">get</span>(<span class="string">'/logout'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">        req.session.user = <span class="literal">null</span>;</span><br><span class="line">        req.session.error = <span class="literal">null</span>;</span><br><span class="line">        res.redirect(<span class="string">'index'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.app.js文件中请求路径为logout、home、login的代码就可以删除了</p>
<p>6.新增的三个文件我们改如何使用呢，很简单，如下所示：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require<span class="list">('./login')</span><span class="list">(<span class="keyword">app</span>)</span><span class="comment">;</span></span><br><span class="line">require<span class="list">('./home')</span><span class="list">(<span class="keyword">app</span>)</span><span class="comment">;</span></span><br><span class="line">require<span class="list">('./logout')</span><span class="list">(<span class="keyword">app</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>对，就是这么简单，我们只需引用路由的目录即可。</p>
<p>到这里我们的用户登陆功能就安全了，现学现用赶快试试效果吧！</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/15/Nodejs入门/" itemprop="url">
                  Nodejs入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-15T19:38:32+08:00" content="Mar 15 2016">
              Mar 15 2016
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/15/Nodejs入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/15/Nodejs入门/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>总结<a href="http://www.hubwiz.com/course/5359f6f6ec7452081a7873d8/" target="_blank" rel="external">http://www.hubwiz.com/course/5359f6f6ec7452081a7873d8/</a></p>
<h1 id="快速入门">快速入门</h1><h2 id="hello_world">hello world</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello world'</span>);</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="blockquote">&gt; hello world</span></span><br></pre></td></tr></table></figure>
<h2 id="回调函数">回调函数</h2><p>由于node是一个异步事件驱动的平台，所以在代码中我们经常需要使用回调函数。下面是回调函数应用的经典示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback is called'</span>);</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>我们传给setTimeout函数传入了一个匿名函数和一个调用时间2000(毫秒)，运行程序后等待2秒，可以看到输出了”callback is called”。</p>
<h2 id="标准回调函数">标准回调函数</h2><p>node.js中回调函数格式是约定俗成的，它有两个参数，第一个参数为err，第二个参数为data，顾名思义，err是错误信息，data则是返回的数据，示例如下:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(err,data)</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了养成良好的编码习惯，在以后的课程示例或练习中，回调函数格式都将采用这样的格式。</p>
<h2 id="获取模块">获取模块</h2><p>为了支持快速开发，node平台上提供了大量的模块，封装了各自不同的功能，那么我们将如何调获取想要的模块呢，下来我们就来介绍。 在node中，我们可以使用require函数，具体语法如下：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"模块"</span>);</span><br></pre></td></tr></table></figure>
<p>怎么样，是不是很简单很方便，通过require函数我们就可以获取相应模块进而使用它的任意功能了。</p>
<h2 id="使用模块">使用模块</h2><p>os模块可提供操作系统的一些基本信息，它的一些常用方法如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> os = require(<span class="string">"os"</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = os.platform(); //查看操作系统平台</span><br><span class="line">           //os.release(); 查看操作系统版本</span><br><span class="line">           //os.<span class="keyword">type</span>();  查看操作系统名称</span><br><span class="line">           //os.arch();  查看操作系统<span class="type">CPU</span>架构</span><br><span class="line"> </span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h1 id="进程管理">进程管理</h1><h2 id="简介">简介</h2><p>process是一个全局内置对象，可以在代码中的任何位置访问此对象，这个对象代表我们的node.js代码宿主的操作系统进程对象。</p>
<p>使用process对象可以截获进程的异常、退出等事件，也可以获取进程的当前目录、环境变量、内存占用等信息，还可以执行进程退出、工作目录切换等操作。</p>
<p>下面我们一起来学习一下process对象的一些常用方法。</p>
<h2 id="cwd函数的基本用法">cwd函数的基本用法</h2><p>当我们想要查看应用程序当前目录时，可以使用cwd函数，使用语法如下：</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.cwd<span class="comment">()</span>;</span><br></pre></td></tr></table></figure>
<h2 id="chdir函数的基本用法">chdir函数的基本用法</h2><p>如果需要改变应用程序目录，就要使用chdir函数了，它的用法如下：</p>
<p>process.chdir(“目录”);</p>
<h2 id="stdout的基本用法">stdout的基本用法</h2><p>stdout是标准输出流，它是干什么的呢？请下看下面的示例：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="built_in">log</span> = <span class="function"><span class="keyword">function</span><span class="params">(d)</span></span>&#123;</span><br><span class="line">    process.stdout.<span class="built_in">write</span>(d+<span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没错，它的作用就是将内容打印到输出设备上，console.log就是封装了它。</p>
<h2 id="stderr的基本用法">stderr的基本用法</h2><p>stderr是标准错误流，和stdout的作用差不多，不同的是它是用来打印错误信息的，我们可以通过它来捕获错误信息，基本使用方法如下：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.stderr.<span class="command">write</span>(输入内容);</span><br></pre></td></tr></table></figure>
<h2 id="stdin的基本用法">stdin的基本用法</h2><p>stdin是进程的输入流,我们可以通过注册事件的方式来获取输入的内容，如下：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">process.stdin.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chunk = process.stdin.read();</span><br><span class="line">  <span class="keyword">if</span> (chunk !== <span class="literal">null</span>) &#123;</span><br><span class="line">    process.stdout.write(<span class="string">'data: '</span> + chunk);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>示例中的chunk就是输入流中的内容。</p>
<h2 id="exit函数的基本用法">exit函数的基本用法</h2><p>如果你需要在程序内杀死进程，退出程序，可以使用exit函数，示例如下：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">process</span>.<span class="keyword">exit</span>(code);</span><br></pre></td></tr></table></figure>
<p>参数code为退出后返回的代码，如果省略则默认返回0；</p>
<h2 id="注册事件">注册事件</h2><p>前面讲到如何在输入流中打印信息，当我们需要获取stdout内容的时候应该怎么做呢？请看如下的示例：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.stdout.<span class="keyword">on</span>(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span><span class="params">(data)</span><span class="comment">&#123;</span><br><span class="line">   console.log(data);</span><br><span class="line">&#125;</span>);</span></span><br></pre></td></tr></table></figure>
<p>为stdout注册data事件，我们就可以拿到它输出的内容了。</p>
<h2 id="设置编码">设置编码</h2><p>在我们的输入输出的内容中有中文的时候，可能会乱码的问题，这是因为编码不同造成的，所以在这种情况下需要为流设置编码，如下示例：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="literal">stdin</span>.setEncoding(编码);</span><br><span class="line"> </span><br><span class="line">process.<span class="literal">stdout</span>.setEncoding(编码);</span><br><span class="line"> </span><br><span class="line">process.<span class="literal">stderr</span>.setEncoding(编码);</span><br></pre></td></tr></table></figure>
<h2 id="课程小结">课程小结</h2><p>process的常用方法就讲到这里了，如果你想了解更多可以参考以下地址：</p>
<p><a href="http://nodejs.cn/api/process" target="_blank" rel="external">http://nodejs.cn/api/process</a><br><a href="http://nodeapi.ucdok.com/#/api/process.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/process.html</a></p>
<h1 id="文件I/O_fs模块的基本用法">文件I/O fs模块的基本用法</h1><p>开发中我们经常会有文件I/O的需求，node.js中提供一个名为fs的模块来支持I/O操作，fs模块的文件I/O是对标准POSIX函数的简单封装。</p>
<h2 id="writeFile函数的基本用法">writeFile函数的基本用法</h2><p>文件I/O，写入是必修课之一。fs模块提供writeFile函数，可以异步的将数据写入一个文件, 如果文件已经存在则会被替换。用法如下：</p>
<blockquote>
<p>例：fs.writeFile(filename, data, callback)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs= <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"> </span><br><span class="line">fs.writeFile(<span class="string">'test.txt'</span>, <span class="string">'Hello Node'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'Saved successfully'</span>); <span class="comment">//文件被保存</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>数据参数可以是string或者是Buffer,编码格式参数可选，默认为”utf8”，回调函数只有一个参数err。</p>
<h2 id="appendFile函数的基本用法">appendFile函数的基本用法</h2><p>writeFile函数虽然可以写入文件，但是如果文件已经存在，我们只是想添加一部分内容，它就不能满足我们的需求了，很幸运，fs模块中还有appendFile函数，它可以将新的内容追加到已有的文件中，如果文件不存在，则会创建一个新的文件。使用方法如下：</p>
<blockquote>
<p>例：fs.appendFile(文件名,数据,编码,回调函数(err));</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs= <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"> </span><br><span class="line">fs.appendFile(<span class="string">'test.txt'</span>, <span class="string">'data to append'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//数据被添加到文件的尾部</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'The "data to append" was appended to file!'</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>编码格式默认为”utf8”</p>
<h2 id="exists函数的基本用法">exists函数的基本用法</h2><p>如何检查一个文件是否存在呢？我想exists函数可以帮助你，用法如下：</p>
<blockquote>
<p>例：fs.exists(文件，回调函数(exists));</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exists的回调函数只有一个参数，类型为布尔型，通过它来表示文件是否存在。</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs= <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"> </span><br><span class="line">fs.exists(<span class="string">'/etc/passwd'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(exists)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(exists ? <span class="string">"存在"</span> : <span class="string">"不存在!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="rename函数的基本用法">rename函数的基本用法</h2><p>修改文件名称是我们经常会遇见的事情，rename函数提供修改名称服务：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs= require(<span class="string">"fs"</span>);</span><br><span class="line"> </span><br><span class="line">fs.<span class="keyword">rename</span>(旧文件，新文件，回调函数(<span class="keyword">err</span>)&#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">err</span>) throw <span class="keyword">err</span>;</span><br><span class="line">   console.<span class="literal">log</span>('Successful modification,');</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="rename函数的基本用法-1">rename函数的基本用法</h2><p>移动文件也是我们经常会遇见的，可是fs没有专门移动文件的函数，但是我们可以通过rename函数来达到移动文件的目的，示例如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line">fs.rename(oldPath,newPath,<span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'renamed complete'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="readFile函数的基本用法">readFile函数的基本用法</h2><p>读取文件是最常用到的功能之一，使用fs模块读取文件语法如下：</p>
<blockquote>
<p>例：fs.readFile(文件,编码,回调函数);</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line">fs.readFile(文件名, <span class="function"><span class="keyword">function</span> <span class="params">(err, data)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>回调函数里面的data,就是读取的文件内容。</p>
<h2 id="unlink函数的基本用法">unlink函数的基本用法</h2><p>面对一堆垃圾的文件总是有想删除的冲动，我有强迫症？你才有呢。</p>
<p>好在有unlink函数，终于得救了，示例如下：</p>
<blockquote>
<p>例：fs.unlink(文件,回调函数(err));</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line">fs.unlink(文件, <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'successfully deleted'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="mkdir函数的基本用法">mkdir函数的基本用法</h2><p>除了针对文件的操作，目录的创建、删除也经常遇到的，下面我们来看看node.js中如何创建目录：</p>
<blockquote>
<p>fs.mkdir(路径，权限，回调函数(err));<br>参数</p>
</blockquote>
<p>路径：新创建的目录。<br>权限：可选参数，只在linux下有效，表示目录的权限，默认为0777，表示文件所有者、文件所有者所在的组的用户、所有用户，都有权限进行读、写、执行的操作。<br>回调函数：当发生错误时，错误信息会传递给回调函数的err参数。</p>
<h2 id="rmdir函数的基本用法">rmdir函数的基本用法</h2><p>删除目录也是必不可少的功能，rmdir函数可以删除指定的目录：</p>
<blockquote>
<p>例：fs.rmdir(路径，回调函数(err));</p>
</blockquote>
<p>var fs = require(‘fs’);</p>
<p>fs.rmdir(path, function(err) {<br>  if (err) throw err;<br>  console.log(‘ok’);<br>});</p>
<h2 id="readdir函数的基本用法">readdir函数的基本用法</h2><p>如果要读取目录下所有的文件应该怎么办呢？readdir函数可以读取到指定目录下所有的文件，示例如下：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line">fs.readdir(目录,回调函数(err,files));</span><br></pre></td></tr></table></figure>
<p>回调函数 (callback) 接受两个参数 (err, files) 其中 files 是一个存储目录中所包含的文件名称的数组，数组中不包括 ‘.’ 和 ‘..’。</p>
<h2 id="课程小结-1">课程小结</h2><p>文件I/O是最基本的操作，应该熟悉掌握。</p>
<p>fs模块不但提供异步的文件操作，还提供相应的同步操作方法，需要指出的是，nodejs采用异步I/O正是为了避免I/O时的等待时间，提高CPU的利用率，所以在选择使用异步或同步方法的时候需要权衡取舍。</p>
<p>本节课程讲解了fs模块常用的一些功能，当然它还有更多强大的功能，如果你想了解更多，可以参考以下资料：</p>
<p><a href="http://nodejs.cn/api/fs" target="_blank" rel="external">http://nodejs.cn/api/fs</a></p>
<p><a href="http://nodeapi.ucdok.com/#/api/fs.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/fs.html</a></p>
<h1 id="url处理_url模块的基本用法">url处理 url模块的基本用法</h1><p>node.js为互联网而生，和url打交道是无法避免的了，url模块提供一些基础的url处理。</p>
<h2 id="parse函数的基础用法">parse函数的基础用法</h2><p>parse函数的作用是解析url，返回一个json格式的数组，请看如下示例：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line">url.parse(<span class="string">'http://www.baidu.com'</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attribute">protocol</span>: <span class="string">'http:'</span>,</span><br><span class="line">  <span class="attribute">slashes</span>: null,</span><br><span class="line">  <span class="attribute">auth</span>: null,</span><br><span class="line">  <span class="attribute">host</span>: null,</span><br><span class="line">  <span class="attribute">port</span>: null,</span><br><span class="line">  <span class="attribute">hostname</span>: null,</span><br><span class="line">  <span class="attribute">hash</span>: null,</span><br><span class="line">  <span class="attribute">search</span>: null,</span><br><span class="line">  <span class="attribute">query</span>: null,</span><br><span class="line">  <span class="attribute">pathname</span>: <span class="string">'www.baidu.com'</span>,</span><br><span class="line">  <span class="attribute">path</span>: <span class="string">'www.baidu.com'</span>,</span><br><span class="line">  <span class="attribute">href</span>: <span class="string">'http://www.baidu.com'</span> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="parse函数_——_条件解析">parse函数 —— 条件解析</h2><p>parse函数的第二个参数是布尔类型，当参数为true时，会将查询条件也解析成json格式的对象。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line">url.parse(<span class="string">'http://www.baidu.com?page=1'</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">protocol:</span> <span class="string">'http:'</span>,</span><br><span class="line"><span class="label">  slashes:</span> <span class="literal">true</span>,</span><br><span class="line"><span class="label">  auth:</span> <span class="literal">null</span>,</span><br><span class="line"><span class="label">  host:</span> <span class="string">'www.baidu.com'</span>,</span><br><span class="line"><span class="label">  port:</span> <span class="literal">null</span>,</span><br><span class="line"><span class="label">  hostname:</span> <span class="string">'www.baidu.com'</span>,</span><br><span class="line"><span class="label">  hash:</span> <span class="literal">null</span>,</span><br><span class="line"><span class="label">  search:</span> <span class="string">'?page=1'</span>,</span><br><span class="line"><span class="label">  query:</span> &#123; <span class="string">page:</span> <span class="string">'1'</span> &#125;,</span><br><span class="line"><span class="label">  pathname:</span> <span class="string">'/'</span>,</span><br><span class="line"><span class="label">  path:</span> <span class="string">'/?page=1'</span>,</span><br><span class="line"><span class="label">  href:</span> <span class="string">'http://www.baidu.com/?page=1'</span> &#125;</span><br></pre></td></tr></table></figure>
<p>试一试，当参数分别为true和false时，返回数据中的query字段的内容有什么不同。</p>
<h2 id="parse函数_——_解析主机">parse函数 —— 解析主机</h2><p>parse函数的第三个参数也是布尔类型的，当参数为true，解析时会将url的”//“和第一个”/“之间的部分解析为主机名，示例如下：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line">url.parse(<span class="string">'http://www.baidu.com/news'</span>,<span class="literal">false</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attribute">protocol</span>: <span class="string">'http:'</span>,</span><br><span class="line">  <span class="attribute">slashes</span>: true,</span><br><span class="line">  <span class="attribute">auth</span>: null,</span><br><span class="line">  <span class="attribute">host</span>: <span class="string">'www.baidu.com'</span>,</span><br><span class="line">  <span class="attribute">port</span>: null,</span><br><span class="line">  <span class="attribute">hostname</span>: <span class="string">'www.baidu.com'</span>,</span><br><span class="line">  <span class="attribute">hash</span>: null,</span><br><span class="line">  <span class="attribute">search</span>: null,</span><br><span class="line">  <span class="attribute">query</span>: null,</span><br><span class="line">  <span class="attribute">pathname</span>: <span class="string">'/news'</span>,</span><br><span class="line">  <span class="attribute">path</span>: <span class="string">'/news'</span>,</span><br><span class="line">  <span class="attribute">href</span>: <span class="string">'http://www.baidu.com/news'</span> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="format函数的基础用法">format函数的基础用法</h2><p>format函数的作用与parse相反，它的参数是一个JSON对象，返回一个组装好的url地址，请看如下示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var url = require(<span class="string">'url'</span>);</span><br><span class="line">url.format(&#123;</span><br><span class="line"><span class="string">protocol:</span> <span class="string">'http:'</span>,</span><br><span class="line"><span class="string">hostname:</span><span class="string">'www.baidu.com'</span>,</span><br><span class="line"><span class="string">port:</span><span class="string">'80'</span>,</span><br><span class="line"><span class="string">pathname :</span><span class="string">'/news'</span>,</span><br><span class="line"><span class="string">query:</span>&#123;<span class="string">page:</span><span class="number">1</span>&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//www.baidu.com/news?page=1</span></span><br></pre></td></tr></table></figure>
<p>参数JSON对象的字段跟parse函数解析后返回的JSON字段一一对应。</p>
<p>试一试传入一个对象，看看返回url是什么。</p>
<h2 id="resolve函数的基础用法">resolve函数的基础用法</h2><p>resolve函数的参数是两个路径，第一个路径是开始的路径或者说当前路径，第二个则是想要去往的路径，返回值是一个组装好的url，示例如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var url = <span class="keyword">require</span>(<span class="string">'url'</span>);</span><br><span class="line">url.resolve(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>)  /<span class="regexp">/ 'http:/</span><span class="regexp">/example.com/one</span><span class="string">'</span><br><span class="line">url.resolve('</span><span class="symbol">http:</span>/<span class="regexp">/example.com/one</span><span class="string">', '</span>/two<span class="string">') // '</span><span class="symbol">http:</span>/<span class="regexp">/example.com/two</span><span class="string">'</span></span><br></pre></td></tr></table></figure>
<p>动动手，试一试resolve函数。</p>
<h2 id="课程小结-2">课程小结</h2><p>本节课程讲解了url模块常用的一些功能，如果你想了解更多，可以参考以下资料：</p>
<p><a href="http://nodejs.cn/api/url" target="_blank" rel="external">http://nodejs.cn/api/url</a></p>
<h1 id="path优化_path模块的基本用法">path优化 path模块的基本用法</h1><p>本模块包含一套用于处理和转换文件路径的工具集,用于处理目录的对象，提高用户开发效率，让我们一起来快速的认识path对象的一些常用方法吧！</p>
<h2 id="normalize函数的基本用法">normalize函数的基本用法</h2><p>normalize函数将不符合规范的路径经过格式化转换为标准路径,解析路径中的.与..外，还能去掉多余的斜杠。</p>
<p>如下示例：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> path <span class="subst">=</span> <span class="keyword">require</span>(<span class="string">'path'</span>);  </span><br><span class="line"><span class="built_in">var</span> <span class="built_in">data</span> <span class="subst">=</span> path<span class="built_in">.</span>normalize(<span class="string">'/path///normalize/hi/..'</span>);</span><br><span class="line">console<span class="built_in">.</span><span class="keyword">log</span>(<span class="built_in">data</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'/path/normalize/'</span></span><br></pre></td></tr></table></figure>
<p>看了上面的示例，是不是感觉很So easy，赶快寻个路径试试效果吧(按步操作哟)！</p>
<h2 id="join函数的基本用法">join函数的基本用法</h2><p>join函数将传入的多个路径拼接为标准路径并将其格式化，返回规范后的路径，避免手工拼接路径字符串的繁琐. 如下示例：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> path <span class="subst">=</span> <span class="keyword">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">data</span> <span class="subst">=</span> path<span class="built_in">.</span><span class="keyword">join</span>(<span class="string">'///you'</span>, <span class="string">'/are'</span>, <span class="string">'//beautiful'</span>);</span><br><span class="line">console<span class="built_in">.</span><span class="keyword">log</span>(<span class="built_in">data</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">'/you/are/beautiful'</span></span><br></pre></td></tr></table></figure>
<h2 id="dirname函数用来返回路径中的目录名-_如下示例：">dirname函数用来返回路径中的目录名. 如下示例：</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> path <span class="subst">=</span> <span class="keyword">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">data</span> <span class="subst">=</span> path<span class="built_in">.</span>dirname(<span class="string">'/foo/strong/cool/nice'</span>); </span><br><span class="line">console<span class="built_in">.</span><span class="keyword">log</span>(<span class="built_in">data</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'/foo/strong/cool'</span></span><br></pre></td></tr></table></figure>
<h2 id="basename函数的基本用法">basename函数的基本用法</h2><p>basename函数可返回路径中的最后一部分，并且可以对其进行条件排除. 如下示例：</p>
<p>例1：path.basename(‘路径字符串’);</p>
<p>例2：path.basename(‘路径字符串’, ‘[ext]’)&lt;排除[ext]后缀字符串&gt;;</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);    </span><br><span class="line"><span class="reserved">var</span> data1 = path.basename(<span class="string">'/foo/strong/basename/index.html'</span>);</span><br><span class="line"><span class="reserved">var</span> data2 = path.basename(<span class="string">'/foo/strong/basename/index.html'</span>,<span class="string">'.html'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data1 + <span class="string">' "and" '</span> + data2);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">'index</span>.html <span class="string">"and"</span> index'</span><br></pre></td></tr></table></figure>
<h2 id="extname函数的基本用法">extname函数的基本用法</h2><p>extname函数返回路径中文件的扩展名(以最后一个’.’开始,返回’.’以及’.’以后的所有字符串,如没有’.’,则返回空字符串). 如下示例：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> path <span class="subst">=</span> <span class="keyword">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">data</span> <span class="subst">=</span> path<span class="built_in">.</span>extname(<span class="string">'index.html'</span>);</span><br><span class="line">console<span class="built_in">.</span><span class="keyword">log</span>(<span class="built_in">data</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'.html'</span></span><br></pre></td></tr></table></figure>
<h2 id="课程小结-3">课程小结</h2><p>很高兴您学完了本节课程，关于path的一些常用方法就先讲到这里了，如果您还想了解更多的话,可以参考以下地址：</p>
<p><a href="http://nodejs.cn/api/path" target="_blank" rel="external">http://nodejs.cn/api/path</a> </p>
<p><a href="http://nodeapi.ucdok.com/#/api/path.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/path.html</a></p>
<h1 id="字符串转换_Query_String模块的基本介绍">字符串转换 Query String模块的基本介绍</h1><p>Query String模块用于实现URL参数字符串与参数对象之间的互相转换，提供了”stringify”、”parse”等一些实用函数来针对字符串进行处理，通过序列化和反序列化，来更好的应对实际开发中的条件需求，对于逻辑的处理也提供了很好的帮助，下面就让我们一起来了解学习它吧！</p>
<h2 id="stringify函数的基本用法">stringify函数的基本用法</h2><p>stringify函数的作用就是序列化对象，也就是说将对象类型转换成一个字符串类型（默认的分割符（”&amp;”）和分配符（”=”）），本节先介绍它的基本用法，在下一节里我们将学习如何替换默认分配符，下面我们就通过以下例子来清楚的认识一下吧！</p>
<blockquote>
<p>例1：querystring.stringify(“对象”)</p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring= require('querystring');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = querystring.stringify(&#123;foo:'bar',cool:['xux', 'yys']&#125;);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">foo=</span>bar&amp;<span class="variable">cool=</span>xux&amp;<span class="variable">cool=</span>yys</span><br></pre></td></tr></table></figure>
<h2 id="stringify函数的多参数用法">stringify函数的多参数用法</h2><p>这节我们来学习stringify函数的多参数用法，上节我们知道了对象被序列化为字符串之后默认是通过分割符（”&amp;”）和分配符（”=”）组成的，那可不可以改变呢，这节我们就来了解一下，是否可以自己去定义组合结果，看下面的小例子</p>
<blockquote>
<p>例1：querystring.stringify(“对象”，”分隔符”，”分配符”)</p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring = require('querystring');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = querystring.stringify(&#123;foo:'bar',cool:['xux', 'yys']&#125;,'*','$');</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'foo<span class="variable">$bar</span>*cool<span class="variable">$xux</span>*cool<span class="variable">$yys</span>'</span><br></pre></td></tr></table></figure>
<h2 id="parse函数的基本用法">parse函数的基本用法</h2><p>刚刚我们已经学习了stringify函数的作用，接下来就来学习反序列化函数——parse函数，parse函数的作用就是反序列化字符串（默认是由”=”、”&amp;”拼接而成），转换得到一个对象类型。如下示例：</p>
<blockquote>
<p>例1：querystring.parse(“字符串”)</p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring = require('querystring');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = querystring.parse('foo=bar&amp;cool=xux&amp;cool=yys');</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attribute">foo</span>: <span class="string">'bar'</span>, <span class="attribute">cool</span>: [<span class="string">'xux'</span>, <span class="string">'yys'</span>]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="parse函数的多参数用法">parse函数的多参数用法</h2><p>现在我们学习parse函数的扩展用法，和上节stringify函数的多参数用法不同的是，parse函数可以根据用户所自定义的分割符、分配符来反序列化字符串，从而得到相应的对象结果.如下示例：</p>
<blockquote>
<p>例1：querystring.parse(“字符串”，”分隔符”，”分配符”)</p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> querystring = require('querystring');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = querystring.parse('foo@bar$cool@xux$cool@yys','@','$');</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attribute">foo</span>: <span class="string">''</span>, <span class="attribute">bar</span>: <span class="string">'cool'</span>, <span class="attribute">xux</span>: <span class="string">'cool'</span>, <span class="attribute">yys</span>: <span class="string">''</span> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="课程小结-4">课程小结</h2><p>很高兴您学完了本节课程，关于querystring的一些常用方法就先讲到这里了，如果您还想了解更多的话,可以参考以下地址：</p>
<p><a href="http://nodejs.cn/api/querystring" target="_blank" rel="external">http://nodejs.cn/api/querystring</a><br><a href="http://nodeapi.ucdok.com/#/api/querystring.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/querystring.html</a></p>
<h1 id="实用工具_UTIL模块的基本介绍">实用工具 UTIL模块的基本介绍</h1><p>关于模块的如何访问前面已经讲述过了，相信大家已经完全掌握了，这节课我们来学习util模块。util模块呢，是一个Node.js核心模块，提供常用函数的集合，用于弥补核心JavaScript的一些功能过于精简的不足。并且还提供了一系列常用工具，用来对数据的输出和验证。</p>
<h2 id="inspect函数的基本用法">inspect函数的基本用法</h2><p>util.inspect(object,[showHidden],[depth],[colors])是一个将任意对象转换为字符串的函数，通常用于调试和错误输出。它至少接受一个参数object，即要转换的对象,我们来学习它的简单用法。使用语法如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.inspect(<span class="keyword">object</span>);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h2 id="format函数的基本用法">format函数的基本用法</h2><p>format函数根据第一个参数，返回一个格式化字符串，第一个参数是一个可包含零个或多个占位符的字符串。每一个占位符被替换为与其对应的转换后的值，支持的占位符有：”%s(字符串)”、”%d(数字&lt;整型和浮点型&gt;)”、”%j(JSON)”、”%(单独一个百分号则不作为一个参数)”。</p>
<p>1：如果占位符没有相对应的参数，占位符将不会被替换.如示例：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.format('%s:%s', 'foo');</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">'foo</span>:%s'</span><br></pre></td></tr></table></figure>
<p>2：如果有多个参数占位符，额外的参数将会调用util.inspect()转换为字符串。这些字符串被连接在一起，并且以空格分隔。如示例：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.format('%s:%s', 'foo', 'bar', 'baz');</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">'foo</span>:bar baz'</span><br></pre></td></tr></table></figure>
<p>3：如果第一个参数是一个非格式化字符串，则会把所有的参数转成字符串并以空格隔开拼接在一块，而且返回该字符串。如示例：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.format(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'1 2 3'</span></span><br></pre></td></tr></table></figure>
<h2 id="isArray函数的基本用法">isArray函数的基本用法</h2><p>isArray函数可以判断对象是否为数组类型，是则返回ture,否则为false。语法如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.isArray(<span class="keyword">object</span>);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h2 id="isDate函数的基本用法">isDate函数的基本用法</h2><p>isDate函数可以判断对象是否为日期类型，是则返回ture,否则返回false。语法如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.isDate(<span class="keyword">object</span>);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h2 id="isRegExp函数的基本用法">isRegExp函数的基本用法</h2><p>isRegExp函数可以判断对象是否为正则类型，是则返回ture,否则返回false。语法如下：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = require('util');</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = util.isRegExp(<span class="keyword">object</span>);</span><br><span class="line">console.log(<span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h2 id="课程小结-5">课程小结</h2><p>很高兴您学完了本节课程，关于util模块的一些常用方法就先讲到这里了，如果您还想了解更多的话,可以参考以下地址：</p>
<p><a href="http://nodejs.cn/api/util" target="_blank" rel="external">http://nodejs.cn/api/util</a></p>
<p><a href="http://nodeapi.ucdok.com/#/api/util.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/util.html</a></p>
<h1 id="子进程_child_process模块的基本介绍">子进程 child_process模块的基本介绍</h1><p>众所周知node.js是基于单线程模型架构，这样的设计可以带来高效的CPU利用率，但是无法却利用多个核心的CPU，为了解决这个问题，node.js提供了child_process模块，通过多进程来实现对多核CPU的利用. child_process模块提供了四个创建子进程的函数，分别是spawn，exec，execFile和fork。</p>
<h2 id="pawn函数的简单用法">pawn函数的简单用法</h2><p>spawn函数用给定的命令发布一个子进程，只能运行指定的程序，参数需要在列表中给出。如下示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">var</span> child = child_process.spawn( command );</span><br><span class="line">child.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通过执行命令得到返回结果，我们就可以拿到标准输出流数据了。</p>
<h2 id="exec函数的简单用法">exec函数的简单用法</h2><p>exec也是一个创建子进程的函数，与spawn函数不同它可以直接接受一个回调函数作为参数，回调函数有三个参数，分别是err, stdout , stderr，基本使用方法如下：</p>
<p>var child_process = require(‘child_process’);<br>child_process.exec( command , function(err, stdout , stderr ) {<br>  console.log( stdout );<br>});<br>exec函数可以直接接受一个回调函数作为参数，回调函数有三个参数，分别是err, stdout,stderr，非常方便直接使用，</p>
<h2 id="execFile函数的简单用法">execFile函数的简单用法</h2><p>execFile函数与exec函数类似，但execFile函数更显得精简，因为它可以直接执行所指定的文件，基本使用方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line">child_process.execFile( file , <span class="function"><span class="keyword">function</span><span class="params">(err, stdout , stderr )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log( stdout );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>execFile与spawn的参数相似，也需要分别指定执行的命令和参数，但可以接受一个回调函数，与exec的回调函数相同。</p>
<h2 id="execFile函数的简单用法-1">execFile函数的简单用法</h2><p>execFile函数与exec函数类似，但execFile函数更显得精简，因为它可以直接执行所指定的文件，基本使用方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line">child_process.execFile( file , <span class="function"><span class="keyword">function</span><span class="params">(err, stdout , stderr )</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log( stdout );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>execFile与spawn的参数相似，也需要分别指定执行的命令和参数，但可以接受一个回调函数，与exec的回调函数相同。</p>
<h2 id="课程小结-6">课程小结</h2><p>恭喜你学完了本节课程，关于child_process的四个函数的基本简单用法，就先讲到这里了，如果您还想深入了解学习的话,可以参考以下地址：</p>
<p><a href="http://nodejs.cn/api/child_process" target="_blank" rel="external">http://nodejs.cn/api/child_process</a><br><a href="http://nodeapi.ucdok.com/#/api/child_process.html" target="_blank" rel="external">http://nodeapi.ucdok.com/#/api/child_process.html</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/25/eclipes-to-androidstudio/" itemprop="url">
                  Android project from eclipes to androidstudio
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-02-25T14:55:23+08:00" content="Feb 25 2016">
              Feb 25 2016
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/25/eclipes-to-androidstudio/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/25/eclipes-to-androidstudio/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="jar包冲突">jar包冲突</h2><blockquote>
<p>Error:Execution failed for task ‘:app:transformResourcesWithMergeJavaResForDebug’.<br>com.android.build.api.transform.TransformException: com.android.builder.packaging.DuplicateFileException: Duplicate files copied in APK META-INF/LICENSE.txt<br>      File1: /Users/wpmac/AndroidStudioProjects/Android_XinJiang/app/libs/httpmime-4.1.1.jar<br>      File2: /Users/wpmac/AndroidStudioProjects/Android_XinJiang/app/libs/commons-codec-1.4.jar</p>
</blockquote>
 <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">packagingOptions &#123;</span><br><span class="line">     <span class="keyword">exclude</span> <span class="string">'META-INF/DEPENDENCIES'</span></span><br><span class="line">     <span class="keyword">exclude</span> <span class="string">'META-INF/NOTICE'</span></span><br><span class="line">     <span class="keyword">exclude</span> <span class="string">'META-INF/LICENSE'</span></span><br><span class="line">     <span class="keyword">exclude</span> <span class="string">'META-INF/LICENSE.txt'</span></span><br><span class="line">     <span class="keyword">exclude</span> <span class="string">'META-INF/NOTICE.txt'</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="图片资源报错">图片资源报错</h2><blockquote>
<p>AAPT: /Users/wpmac/AndroidStudioProjects/Android_JieQian/app/src/main/res/drawable-xhdpi/suspected_association_normal.png: libpng warning: iCCP: Not recognizing known sRGB profile that has been edited<br>AAPT err(Facade for 203993302) : No Delegate set : lost message:/Users/wpmac/AndroidStudioProjects/Android_JieQian/app/src/main/res/drawable-xhdpi/register_info_normal.png: libpng warning: iCCP: Not recognizing known sRGB profile that has been edited<br>AAPT: /Users/wpmac/AndroidStudioProjects/Android_JieQian/app/src/main/res/drawable-xxhdpi/attention_pressed.png: libpng warning: iCCP: Not recognizing known sRGB profile that has been edited<br>AAPT: /Users/wpmac/AndroidStudioProjects/Android_JieQian/app/src/main/res/drawable-hdpi/splash_imageview.png: libpng warning: iCCP: Not recognizing known sRGB profile that has been edited<br>AAPT: /Users/wpmac/AndroidStudioProjects/Android_JieQian/app/src/main/res/drawable-xhdpi/province_select.png: libpng warning: iCCP: Not recognizing known sRGB profile that has been edited</p>
</blockquote>
<p>buildtools 23.0.2  warning: iCCP: Not recognizing known sRGB profile that has been edited</p>
<p>21.1.1 no warning   iCCP: Not recognizing known sRGB profile that has been edited</p>
<p>not a png file :check png file </p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/14/Meterial-design-for-developer/" itemprop="url">
                  Meterial design for developer
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-02-14T21:05:35+08:00" content="Feb 14 2016">
              Feb 14 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/文档/" itemprop="url" rel="index">
                    <span itemprop="name">文档</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/14/Meterial-design-for-developer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/14/Meterial-design-for-developer/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="入门指南">入门指南</h1><p>如果要使用材料设计创建应用：</p>
<ol>
<li>请查阅材料<a href="http://www.google.com/design/spec/material-design/introduction.html" target="_blank" rel="external">设计规范</a>。<ul>
<li>在您的应用中使用材料主题。</li>
<li>遵循材料设计指导方针创建您的布局。</li>
<li>指定您视图要投射阴影的高度。</li>
<li>使用系统小组件呈现列表与卡片。</li>
<li>定制您的应用中的动画。</li>
</ul>
</li>
</ol>
<p>保持后向兼容性</p>
<p>您可将多个材料设计功能添加至您的应用，同时保持与 Android 5.0 之前的 Android 版本的兼容性。 如果要了解更多信息，请参阅 保持兼容性。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/10/User-Gradle-sample/" itemprop="url">
                  User Gradle sample
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-02-10T01:19:32+08:00" content="Feb 10 2016">
              Feb 10 2016
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/10/User-Gradle-sample/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/10/User-Gradle-sample/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Example_4-1-_Executing_multiple_tasks">Example 4.1. Executing multiple tasks</h1><p>build.gradle</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">task</span> <span class="keyword">compile</span> &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'compiling source'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> compileTest(dependsOn: <span class="keyword">compile</span>) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'compiling unit tests'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> test(dependsOn: [<span class="keyword">compile</span>, compileTest]) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'running unit tests'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> dist(dependsOn: [<span class="keyword">compile</span>, test]) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'building the distribution'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output of gradle dist test</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle dist test</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"><span class="symbol">:test</span></span><br><span class="line">running unit tests</span><br><span class="line"><span class="symbol">:dist</span></span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">1</span> secs</span><br></pre></td></tr></table></figure>
<h1 id="Example_4-2-_Excluding_tasks">Example 4.2. Excluding tasks</h1><p>Output of gradle dist -x test</p>
<p>你能通过使用-x 命令来排除某些任务的执行，我们来使用之前的脚本来演示</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle dist -x test</span><br><span class="line">:compile</span><br><span class="line">compiling source</span><br><span class="line">:dist</span><br><span class="line">building <span class="operator">the</span> distribution</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total <span class="built_in">time</span>: <span class="number">1</span> <span class="built_in">secs</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/10/Gradle-4-Using-the-Gradle-Command-Line/" itemprop="url">
                  Gradle.4 Using the Gradle Command-Line
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-02-10T01:12:31+08:00" content="Feb 10 2016">
              Feb 10 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/文档/" itemprop="url" rel="index">
                    <span itemprop="name">文档</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/10/Gradle-4-Using-the-Gradle-Command-Line/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/10/Gradle-4-Using-the-Gradle-Command-Line/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="4-通过命令行使用gradle">4.通过命令行使用gradle</h1><p>这张将介绍使用gradle命令行的基础知识，就像你在前几章看到的那样</p>
<h2 id="4-1_执行多重任务">4.1 执行多重任务</h2><p>你能使用命令通过一个脚本来执行多个任务，例如这个命令<code>gradle compile test</code>,他会执行compite和test两个任务，gradle会按照命令行中的任务顺序来有序执行，也会运行其依赖项目，每个任务仅仅只执行一次，无论它在脚本中如何被引用，是直接指定还是作为其他任务的依赖，或者两者都是，让我们来看一个例子.</p>
<p>以下四个任务，<code>dist</code>和<code>test</code>都依赖于<code>complie</code>，执行<code>gradle dist test</code>，结果<code>complie</code>任务只会运行一次.</p>
<p>图4.1 task依赖图<br><img src="http://7xqtsx.com1.z0.glb.clouddn.com/commandLineTutorialTasks.png" alt=""><br><code>官方演示图错了，test不是指向complie，而是complie指向test</code></p>
<p>例4.1 执行多任务脚本</p>
<p>build.gradle</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">task</span> <span class="keyword">compile</span> &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'compiling source'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> compileTest(dependsOn: <span class="keyword">compile</span>) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'compiling unit tests'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> test(dependsOn: [<span class="keyword">compile</span>, compileTest]) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'running unit tests'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> dist(dependsOn: [<span class="keyword">compile</span>, test]) &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">println</span> <span class="string">'building the distribution'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gradle dist test的输出</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle dist test</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"><span class="symbol">:test</span></span><br><span class="line">running unit tests</span><br><span class="line"><span class="symbol">:dist</span></span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">1</span> secs</span><br></pre></td></tr></table></figure>
<p>每个任务只执行了一次，所以gradle test test 和 gradle test 的结果是一样的</p>
<p>这是本人测试的，第一次速度明显很慢<br>参考<a href="https://docs.gradle.org/2.11/userguide/gradle_daemon.html" target="_blank" rel="external">https://docs.gradle.org/2.11/userguide/gradle_daemon.html</a></p>
<p>windows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">if</span> not exist <span class="string">"%USERPROFILE%/.gradle"</span> mkdir <span class="string">"%USERPROFILE%/.gradle"</span>) &amp;&amp; (<span class="built_in">echo</span> org.gradle.daemon=<span class="literal">true</span> &gt;&gt; <span class="string">"%USERPROFILE%/.gradle/gradle.properties"</span>)</span><br></pre></td></tr></table></figure>
<p>UNIX:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;touch ~<span class="regexp">/.gradle/gradle</span>.properties &amp;&amp; echo <span class="string">"org.gradle.daemon=true"</span> <span class="prompt">&gt;&gt; </span>~<span class="regexp">/.gradle/gradle</span>.properties</span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="constant">Desktop </span> gradle dist test</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"><span class="symbol">:test</span></span><br><span class="line">running unit tests</span><br><span class="line"><span class="symbol">:dist</span></span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">4.446</span> secs</span><br><span class="line"></span><br><span class="line"><span class="constant">This </span>build could be faster, please consider using the <span class="constant">Gradle Daemon:</span> <span class="symbol">https:</span>/<span class="regexp">/docs.gradle.org/</span><span class="number">2.8</span>/userguide/gradle_daemon.html</span><br><span class="line">➜  <span class="constant">Desktop </span> gradle dist test</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"><span class="symbol">:test</span></span><br><span class="line">running unit tests</span><br><span class="line"><span class="symbol">:dist</span></span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">1.768</span> secs</span><br></pre></td></tr></table></figure>
<h2 id="4-2执行任务">4.2执行任务</h2><p>你能通过使用-x 命令来排除某些任务的执行，我们来使用之前的脚本来演示</p>
<p>例4.2 执行任务<br>gradle dist -x test的输出</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle dist -x test</span><br><span class="line">:compile</span><br><span class="line">compiling source</span><br><span class="line">:dist</span><br><span class="line">building <span class="operator">the</span> distribution</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total <span class="built_in">time</span>: <span class="number">1</span> <span class="built_in">secs</span></span><br></pre></td></tr></table></figure>
<p><img src="http://7xqtsx.com1.z0.glb.clouddn.com/commandLineTutorialTasks.png" alt=""></p>
<p><code>官方演示图错了，test不是指向complie，而是complie指向test</code></p>
<p>从这个示例的输出,可以看到test任务没有执行,即使这是一个dist的依赖任务。你还会注意到依赖于test的任务中,compileTest没有执行。但是test依赖的另一个任务,如complie,仍会被执行。</p>
<h2 id="4-3如何在构建失败的时候继续构建">4.3如何在构建失败的时候继续构建</h2><p>默认情况下，gradle将会在任何任务失败时中止执行。这使得构建更快地完成，但隐藏了其他错误。为了在一个单一的构建尽可能多的发现可能失败的任务，你可以使用—continue选项。</p>
<p>当—continue执行，gradle将执行每项任务，而不是只要遇到第一个故障就停止。遇到的每一个故障将在构建结束时报告。</p>
<p>如果一个任务失败，依赖于它的任何后续任务将不会被执行，因为这样做是不安全的。例如，如果complie的代码发生错误，test就不会被执行，因为test任务依赖于complie任务（直接或间接地） 。</p>
<h2 id="4-4_任务名缩写">4.4 任务名缩写</h2><p>当你命令行指定任务时，不需要提供全名，只要能足够辨认出该任务，在上面同样的脚本中，我们会通过执行<code>gradle -d</code>来执行dist任务</p>
<p>Example 4.3. Abbreviated task name</p>
<p>Output of gradle di</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle di</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"><span class="symbol">:test</span></span><br><span class="line">running unit tests</span><br><span class="line"><span class="symbol">:dist</span></span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">1</span> secs</span><br></pre></td></tr></table></figure>
<p>你也可以缩写驼峰命名的每个词，例如，可以通过<code>gradle compTest</code>甚至<code>gradle cT</code>来执行 compileTest 任务</p>
<p>Example 4.4. Abbreviated camel case task name<br>Output of gradle cT</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle cT</span><br><span class="line"><span class="symbol">:compile</span></span><br><span class="line">compiling source</span><br><span class="line"><span class="symbol">:compileTest</span></span><br><span class="line">compiling unit tests</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD SUCCESSFUL</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">1</span> secs</span><br></pre></td></tr></table></figure>
<p>在使用缩写的同时也可以使用 －x 命令</p>
<h2 id="4-5选择执行的脚本">4.5选择执行的脚本</h2><p>当运行gradle命令时，会从当前路径查找脚本文件，你也可以使用 －b 命令来选择其他文件，如果使用－b命令，setting.gradle 文件就不会被使用，例如：</p>
<p>Example 4.5. Selecting the project using a build file</p>
<p>subdir/myproject.gradle</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">task</span> hello &lt;&lt; &#123;</span><br><span class="line">    <span class="title">println</span> <span class="string">"using build file '<span class="variable">$buildFile</span>.name' in '<span class="variable">$buildFile</span>.parentFile.name'."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output of gradle -q -b subdir/myproject.gradle hello</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -<span class="tag">q</span> -<span class="tag">b</span> subdir/myproject<span class="class">.gradle</span> hello</span><br><span class="line">using build file <span class="string">'myproject.gradle'</span> <span class="keyword">in</span> <span class="string">'subdir'</span>.</span><br></pre></td></tr></table></figure>
<p>或者，你可以使用 －p 命令来指定文件路径，多个工程中，你应该使用－p命令 而不是 －b 命令</p>
<p>Example 4.6. Selecting the project using project directory</p>
<p>Output of gradle -q -p subdir hello</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -<span class="tag">q</span> -<span class="tag">p</span> subdir hello</span><br><span class="line">using build file <span class="string">'build.gradle'</span> <span class="keyword">in</span> <span class="string">'subdir'</span>.</span><br></pre></td></tr></table></figure>
<h2 id="4-6获得构建信息">4.6获得构建信息</h2>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://mzeht.com/uploads/avatar.jpg"
               alt="mzeht" />
          <p class="site-author-name" itemprop="name">mzeht</p>
          <p class="site-description motion-element" itemprop="description">学习总结 思考感悟 知识管理</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mzeht</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mzeht"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
