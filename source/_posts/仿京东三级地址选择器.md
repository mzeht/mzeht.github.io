title: 仿京东三级地址选择器
categories: 
  - 移动开发
  - Android
author: mzeht
avatar: /images/favicon.png
authorDesc: 一个写代码的
date: 2017-05-28 15:16:56
tags:
keywords:
description:
photos:
---

## 效果图
![](http://7xqtsx.com1.z0.glb.clouddn.com/17-5-28/96157233.jpg)

## 实现

```

@BindView(R.id.recive_address_txt)
    TextView mReciveAddressTxt;
```


根据tab的深度和前一项选择的id，获取下一级菜单项
下一级的数据都是由上一级参数网络请求而来

```

mReciveAddressTxt.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                Selector selector = new Selector(getActivity(), 3);

                selector.setDataProvider(new DataProvider() {
                    @Override
                    public void provideData(int currentDeep, int preId, DataReceiver receiver) {
                        //根据tab的深度和前一项选择的id，获取下一级菜单项
                        Log.i(TAG, "provideData: currentDeep >>> " + currentDeep + " preId >>> " + preId);
//                        ApiManager.getBaimiApi().getCity()

                        switch (currentDeep) {
                            case 0:
                                if (proviceList.size() > 0) {
                                    receiver.send(getDatas(proviceList));
                                    return;
                                }
                                ApiManager.getBaimiApi().getProvince().subscribeOn(Schedulers.io())
                                        .observeOn(AndroidSchedulers.mainThread())
                                        .subscribe(new Subscriber<ApiResult<List<String>>>() {
                                            @Override
                                            public void onCompleted() {

                                            }

                                            @Override
                                            public void onError(Throwable e) {

                                            }

                                            @Override
                                            public void onNext(ApiResult<List<String>> listApiResult) {
                                                if (listApiResult.getContent().size() > 0) {
                                                    proviceList = listApiResult.getContent();
                                                    receiver.send(getDatas(proviceList));
                                                }
                                            }
                                        });
                                break;
                            case 1:

                                ApiManager.getBaimiApi().getCity(proviceList.get(preId))
                                        .subscribeOn(Schedulers.io())
                                        .observeOn(AndroidSchedulers.mainThread())
                                        .subscribe(new Subscriber<ApiResult<List<String>>>() {
                                            @Override
                                            public void onCompleted() {

                                            }

                                            @Override
                                            public void onError(Throwable e) {

                                            }

                                            @Override
                                            public void onNext(ApiResult<List<String>> listApiResult) {
                                                if (listApiResult.getFlag().equals("1") || listApiResult.getContent().size() > 0) {
                                                    cityList = listApiResult.getContent();
                                                    receiver.send(getDatas(cityList));
                                                }

                                            }
                                        });
                                break;
                            case 2:
                                ApiManager.getBaimiApi().getArea(cityList.get(preId))
                                        .subscribeOn(Schedulers.io())
                                        .observeOn(AndroidSchedulers.mainThread())
                                        .subscribe(new Subscriber<ApiResult<List<String>>>() {
                                            @Override
                                            public void onCompleted() {

                                            }

                                            @Override
                                            public void onError(Throwable e) {

                                            }

                                            @Override
                                            public void onNext(ApiResult<List<String>> listApiResult) {
                                                if (listApiResult.getFlag().equals("1") || listApiResult.getContent().size() > 0) {
                                                    areaList = listApiResult.getContent();
                                                    receiver.send(getDatas(areaList));
                                                }
                                            }
                                        });
                                break;
                        }

                    }

                    private ArrayList<ISelectAble> getDatas(List<String> list) {
                        int count = list.size();
                        ArrayList<ISelectAble> data = new ArrayList<>(count);
                        for (int j = 0; j < count; j++) {

                            int finalJ = j;
                            data.add(new ISelectAble() {
                                @Override
                                public String getName() {
                                    return list.get(finalJ);
                                }

                                @Override
                                public int getId() {
                                    return finalJ;
                                }

                                @Override
                                public Object getArg() {
                                    return this;
                                }
                            });
                        }
                        return data;
                    }


                });
                selector.setSelectedListener(new SelectedListener() {
                    @Override
                    public void onAddressSelected(ArrayList<ISelectAble> selectAbles) {
                        String result = "";
                        for (ISelectAble selectAble : selectAbles) {
                            result += selectAble.getName() + " ";
                        }
//                        Toast.makeText(getActivity(), result, Toast.LENGTH_SHORT).show();
                        mReciveAddressTxt.setText(result);
                    }
                });

                BottomDialog dialog = new BottomDialog(getActivity());
                dialog.init(getActivity(), selector);
                dialog.show();

            }
        });
```

## 库地址

https://github.com/dunwen/JDSelector

https://github.com/chihane/JDAddressSelector


