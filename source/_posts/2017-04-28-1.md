title: android项目利用cmake方式实现ndk开发
categories: 
  - 移动开发
  - Android
tags:
  - cmake
  - ndk
date: 2017-04-28 14:53:01
author: mzeht
avatar: /images/favicon.png
authorDesc: 一个写代码的
---

## 添加ndk支持
`gradle.properties`(project properties)

```
org.gradle.daemon=true
org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
org.gradle.parallel=true
org.gradle.configureondemand=true
android.useDeprecatedNdk=true
```

## 在需要ndk的模块新建JNI Folder
当前模块下生成了/src/main/jni

这个文件夹下放置`CMakeLists.txt`，和c文件
![](http://7xqtsx.com1.z0.glb.clouddn.com/17-4-28/13776882-file_1493364079424_4904.png)

## 创建CMakeLists.txt
`stringutils` cmake生成so包命名相关
反编译apk，可以发现so包名称为`libstringutils.so`

`SHARED`之后

打包进入so包的文件目录，可以多个

`cmake_minimum_required(VERSION 3.4.1)`默认版本

```
cmake_minimum_required(VERSION 3.4.1)

add_library(stringutils SHARED
            stringutils.c)

# Include libraries needed for stringutils lib
target_link_libraries(stringutils log android)

```

##在java文件中创建native方法


如
```
public class StringUtils {

    public static native String makeSkey(String[] array, Context context);
    static {
        System.loadLibrary("stringutils");
    }
}
```
## 创建c文件
在java报红的方法名处查看智能提示，生成c文件

如


```
#include <jni.h>

JNIEXPORT jstring JNICALL
Java_com_mzeht_wp_skbyjni_StringUtils_makeSkey(JNIEnv *env, jclass type, jobjectArray array,
                                               jobject context) {

    // TODO


    return (*env)->NewStringUTF(env, "hehe");
}

```

返回一个“hehe”，运行android项目即可



